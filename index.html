<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงูุณูุงุฑุงุช (ูุฏูุฌ JsBarcode)</title>
    <style>
        /* ุงูุชูุณูู ุงูุฃุณุงุณู ูุงููุถุน ุงูุฏุงูู */
        body { 
            font-family: 'Courier New', Courier, monospace; 
            font-weight: bold;                          
            background-color: #000000; /* ุฎูููุฉ ุณูุฏุงุก */
            color: #f0f0f0; /* ูุต ุฃุจูุถ ูุงุชุญ */
            padding: 10px; 
        }
        form { 
            width: 100%; margin: 0 auto; 
            background: #1e1e1e; /* ุฎูููุฉ ุงููููุฐุฌ ุฏุงููุฉ */
            padding: 30px; border-radius: 8px; 
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1); 
        }
        fieldset { border: 1px solid #333; padding: 20px; margin-bottom: 30px; border-radius: 5px; }
        legend { font-size: 1.5em; font-weight: bold; color: #007bff; padding: 0 10px; }
        .form-group { margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 15px; }
        .form-group > div { flex: 1 1 150px; min-width: 150px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #cccccc; white-space: nowrap; }
        
        /* โฌ๏ธ ุชูุณูู ุงูุฎุทูุท ููุฑุจุนุงุช ุงูุฅุฏุฎุงู ูู ุฌููุน ุงูุฃูุณุงู */
        input[type="text"], 
        input[type="number"], 
        input[type="date"], 
        textarea, 
        select { 
            width: 100%; 
            padding: 10px; 
            background-color: #2a2a2a; /* ุฎูููุฉ ุฏุงููุฉ ุนุงูุฉ ููุฎุงูุงุช */
            color: #ffffff; /* ูุต ุฃุจูุถ */
            border: 1px solid #555; 
            border-radius: 4px; 
            box-sizing: border-box; 
            
            /* ุชุทุจูู ุฎุท ูุญุฌู ุงููุต ุงููุทููุจ */
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            font-size: 1em; /* ุญุฌู ููุงุณู ูุชูุงุณุจ ูุน ุงููุฑุจุน */
            
            /* ุงูุชุนุฏูู: ุชูุณูุท ุงููุต ุฏุงุฎู ุงูุญูู (ูุฎุงูุงุช ุงููุต ูุงูุฃุฑูุงู) */
            text-align: center;
        }
        
        /* ๐ก ูุญุงุฐุงุฉ ุงูู SELECT ุงูุฎุงุตุฉ ุจูุญุฑู ุงูุจุญุซ ุฅูู ุงููููู */
        #car-selector {
            text-align: right;
            text-align-last: right; /* ูุชุทุจูู ุงููุญุงุฐุงุฉ ุนูู ุงููููุฉ ุงููุฎุชุงุฑุฉ ุฃูุถุงู */
        }
        
        /* ๐ก ุงูุชุนุฏูู ุงูุฎุงุต ุจุงููุณู ุงูุฃุณุงุณู: ุฎุท ุฃุฒุฑู ุบุงูู ุนุฑูุถ ูู ุงููุณู ุงูุฃูู ูุน ุงูุฎูููุฉ ุงูุตูุฑุงุก */
        fieldset:first-of-type input, fieldset:first-of-type select {
            background-color: #ffffe0 !important; /* ุฃุตูุฑ ูุงุชุญ ุฌุฏุงู */
            color: #0056b3 !important; /* ุงูููู ุงูุฃุฒุฑู ุงูุบุงูู */
            font-weight: bold !important; /* ุงูุชุฃููุฏ ุนูู ุงูุฎุท ุงูุนุฑูุถ */
        }
        
        .full-width { flex: 1 1 100%; }
        
        /* ุชูุณูู ุงูุฃุฒุฑุงุฑ */
        .action-buttons { display: flex; justify-content: flex-start; gap: 10px; margin-top: 20px; }
        .action-buttons button, #print-records { 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-weight: bold; 
            transition: background-color 0.3s;
            /* ุชุทุจูู ุฎุท ุงูุฃุฒุฑุงุฑ ุฃูุถุงู */
            font-family: 'Courier New', Courier, monospace;
            font-size: 1em;
        }
        #save-data { background-color: #28a745; color: white; }
        #update-data { background-color: #ffc107; color: #333; }
        #delete-data { background-color: #dc3545; color: white; }
        #add-oil-record { background-color: #17a2b8; color: white; }
        #save-oil-edit { background-color: #007bff; color: white; display: none; }
        #add-maintenance-record { background-color: #8c5dff; color: white; }
        #save-maintenance-edit { background-color: #007bff; color: white; display: none; }
        /* ุฃุฒุฑุงุฑ ูุทุน ุงูุบูุงุฑ ุงูุฌุฏูุฏุฉ */
        #add-parts-record { background-color: #6f42c1; color: white; }
        #save-parts-edit { background-color: #007bff; color: white; display: none; }
        
        /* ุฒุฑ ุงูุทุจุงุนุฉ ูู ููุงูุฉ ุงููููุฐุฌ ุงูุนุงู (ุชู ุฅุฎูุงุคู ูุตุงูุญ ุฃุฒุฑุงุฑ ุงูุชูุงุฑูุฑ) */
        #print-records { display: none; } 
        
        /* ุฃุฒุฑุงุฑ ุงูุชูุงุฑูุฑ ูู ุงููุณู ุงูุฎุงูุณ */
        .report-buttons { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
        .report-buttons button { background-color: #ff8c00; color: white; padding: 10px 15px; }
        .report-buttons .full-report-btn { background-color: #9400d3; } /* ููู ูุฎุชูู ููุชูุฑูุฑ ุงูุดุงูู */

        
        /* ุชูุณูู ุงูุฌุฏุงูู ูุนูุงุตุฑ ุงูุทุจุงุนุฉ ูููุถุน ุงูุฏุงูู */
        .records-container { 
            padding: 20px; 
            background-color: #2a2a2a; /* ุฎูููุฉ ุฏุงููุฉ ูุญุงููุฉ ุงูุฌุฏุงูู */
            border-radius: 8px; 
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.05); 
            overflow-x: auto; margin-top: 20px;
        }
        .car-records-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
            font-size: 0.9em; 
            min-width: 1200px; /* ุฒูุงุฏุฉ ุงูุนุฑุถ ูุงุณุชูุนุงุจ ุฃุฒุฑุงุฑ ุงูุชุนุฏูู ูุงูุญุฐู */
            /* ุชุทุจูู ุฎุท ุงูุฌุฏูู ุฃูุถุงู */
            font-family: 'Courier New', Courier, monospace;
        }
        /* ๐ก ุชู ุฅุถุงูุฉ ูุญุงุฐุงุฉ ูููููู ูููุตูุต ูู ุฎูุงูุง ุงูุฌุฏูู ููุชูุงุณุจ ูุน ุงููุบุฉ ุงูุนุฑุจูุฉุ ุจุงุณุชุซูุงุก ุนููุฏ ุงูุฅุฌุฑุงุกุงุช */
        .car-records-table th, .car-records-table td { border: 1px solid #555; padding: 8px; text-align: right; }
        .car-records-table th { 
            background-color: #444444; /* ุฑุคูุณ ุงูุฌุฏูู ุฏุงููุฉ */
            font-weight: bold; 
            color: #ffffff; 
        }
        /* ูุญุงุฐุงุฉ ุนููุฏ ุงูุฅุฌุฑุงุกุงุช ูููุณุงุฑ ูุชููู ุงูุฃุฒุฑุงุฑ ูุงุถุญุฉ */
        .car-records-table th:last-child, .car-records-table td:last-child {
            text-align: left;
        }
        .car-records-table .actions button { 
            padding: 5px 10px; 
            margin-left: 5px;
            font-size: 0.8em;
        }
        .car-records-table .edit-btn { background-color: #ffc107; color: #333; }
        .car-records-table .delete-btn { background-color: #dc3545; color: white; }
        
        /* ูุณู ุงูุทุจุงุนุฉ */
        .print-only { display: none; margin-bottom: 20px; }
        .print-area { display: none; } /* ุฅุฎูุงุก ููุทูุฉ ุงูุทุจุงุนุฉ ุงูุชุฑุงุถูุงู */

        @media print {
            /* ุฅุนุงุฏุฉ ุงูุชุนููู ููุทุจุงุนุฉ (ุงูุฎูููุฉ ุจูุถุงุก ูุงูุฎุท ุทุจูุนู) */
            body { 
                font-family: Arial, sans-serif; 
                font-weight: normal; 
                background-color: #fff; 
                size: A4 landscape; /* ุงูุชุฃููุฏ ุนูู A4 ุฃููู */
                padding: 0;
                margin: 0;
            }
            /* ูุชู ุฅุนุงุฏุฉ ุชุนููู ูู ุงูุฃููุงู ุฅูู ุงูุฃุจูุถ ูุงูุฃุณูุฏ ุฃู ุฏุฑุฌุงุชู */
            .records-container, .car-records-table th, .car-records-table td, form,
            input, select, textarea { 
                background-color: #fff !important;
                color: #000 !important;
                border-color: #999 !important;
                font-family: Arial, sans-serif !important;
                font-weight: normal !important;
                text-align: right !important; /* ุฅูุบุงุก ุงูุชูุณูุท ูู ุงูุทุจุงุนุฉ */
            }
            /* ุฅุฎูุงุก ุนููุฏ ุงูุฅุฌุฑุงุกุงุช ูุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช ุนูุฏ ุงูุทุจุงุนุฉ */
            .car-records-table th:last-child, .car-records-table td:last-child {
                display: none !important;
            }
            /* ุฅุฎูุงุก ูู ุดูุก ูุงุนุฏุง ููุทูุฉ ุงูุทุจุงุนุฉ */
            body > * { display: none !important; }
            .print-area { 
                display: block !important; 
                width: 100%;
                min-height: 100vh;
                padding: 10mm;
            }
            .print-only { display: block; }
            .records-container { box-shadow: none; padding: 0; margin-top: 10px; }
            h2, h4 { page-break-before: auto; font-size: 1.2em; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 20px;}
            
            /* ๐ก ุงูุชุนุฏูู 1: ุชูููุต ุญุฌู ุงูุฎุท ูู ุงูุฌุฏุงูู ุฅูู ุงูุญุฏ ุงูุฃุฏูู */
            .car-records-table { 
                min-width: auto; /* ุฅุฒุงูุฉ ูููุฏ ุงูุนุฑุถ */
                font-size: 0.7em; /* ุชุตุบูุฑ ุงูุฎุท */
            }
            
            /* ๐ก ุงูุชุนุฏูู 2: ุชูููู ุงูุจุงุฏููุบ ูุชุญุฏูุฏ ุฃูุตู ุนุฑุถ */
            .car-records-table td, .car-records-table th { 
                padding: 3px 4px !important; /* ุชูููู ุงูุจุงุฏููุบ ุฌุฏุงู */
                word-wrap: break-word; /* ุงูุณูุงุญ ุจูุณุฑ ุงููููุงุช ุงูุทูููุฉ */
            }
            
            /* ๐ก ุงูุชุนุฏูู 3: ุชุญุฏูุฏ ุนุฑุถ ูุฃุนูุฏุฉ ุงููุตู ูุงูุชูุงุตูู ุงูุทูููุฉ */
            
            /* ุงูุตูุงูุฉ: ุนููุฏ ุงูุชูุงุตูู (details) (ุงูุนููุฏ ุฑูู 3) */
            #maintenance-records-table td:nth-child(3) { 
                max-width: 60px; 
                min-width: 40px;
            }

            /* ูุทุน ุงูุบูุงุฑ: ุงููุตู ูุงูุงุณู (ุงูุนููุฏ ุฑูู 6) + ุงูุถูุงู (ุงูุนููุฏ ุฑูู 7) */
            #parts-records-table td:nth-child(6),
            #parts-records-table td:nth-child(7) { 
                max-width: 60px; 
                min-width: 10px;
            }

            /* ุชุญุฏูุฏ ุนุฑุถ ูุฃุนูุฏุฉ ุงูุจุงุฑููุฏ ููุชูุงุณุจ ูุน ุงูู SVG (ุงูุนููุฏ ุฑูู 5 ูู ูุทุน ุงูุบูุงุฑ) */
            #parts-records-table td:nth-child(5) {
                width: 90px; 
            }
            
            /* ุชุตููุฑ ูุญุงุฐุงุฉ ุงููุต ูู ุฎูุงูุง ุงูุฌุฏูู ุจุงูุทุจุงุนุฉ */
            .car-records-table th, .car-records-table td { text-align: right !important; }
        }
        
        /* ุชูุณูู ุฎุงุต ููุจุงุฑููุฏ */
        #barcode-display-area { text-align: center; }
        /* ุชุญุฏูุฏ ุงุฑุชูุงุน ุงูู SVG ูููุงุฆู ุงูุฌุฏูู */
        #temp-barcode-svg { max-width: 100%; height: 40px; } 
    </style>
</head>
<body>

    <form onsubmit="event.preventDefault()">
        <h1>ูุธุงู ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงูุณูุงุฑุงุช</h1>

        ---

        <fieldset>
            <legend>๐ ุฃููุงู: ุจูุงูุงุช ุงูุณูุงุฑุฉ ุงูุฃุณุงุณูุฉ</legend>
            <div class="form-group full-width">
                <div style="flex: 1 1 300px;">
                    <label for="car-selector">ุงุฎุชุฑ ููุน ุงูุณูุงุฑุฉ:</label>
                    <select id="car-selector" onchange="loadCarData(this.value)">
                        <option value="">** ุงุฎุชุฑ ุฃู ุฃุฏุฎู ุจูุงูุงุช ุฌุฏูุฏุฉ **</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <div><label for="car-make">ุงูุตูุน:</label><input type="text" id="car-make" data-key="make" required></div>
                <div><label for="car-model">ุงูุทุฑุงุฒ:</label><input type="text" id="car-model" data-key="model" required></div>
                <div><label for="car-year">ุงูููุฏูู:</label><input type="number" id="car-year" data-key="year" min="1900" max="2100" required></div>
                <div><label for="car-color">ุงูููู:</label><input type="text" id="car-color" data-key="color"></div>
                <div><label for="car-serial">ุงูุฑูู ุงูุชุณูุณูู (VIN):</label><input type="text" id="car-serial" data-key="serial" required></div>
            </div>

            <div class="form-group">
                <div><label for="recommended-oil-type">ููุน ุงูุฒูุช:</label><input type="text" id="recommended-oil-type" data-key="recommendedOilType"></div>
                <div><label for="oil-quantity">ูููุฉ ุงูุฒูุช (ุนูุจุฉ):</label><input type="text" id="oil-quantity" data-key="oilQuantity"></div>
                <div><label for="reg-expiry-date">ุงูุชูุงุก ุงูุงุณุชูุงุฑุฉ:</label><input type="date" id="reg-expiry-date" data-key="regExpiry"></div>
                <div><label for="insurance-company"> ุดุฑูุฉ ุงูุชุฃููู:</label><input type="text" id="insurance-company" data-key="insuranceCompany"></div>
                <div><label for="insurance-start-date"> ุจุฏุก ุงูุชุฃููู:</label><input type="date" id="insurance-start-date" data-key="insuranceStart"></div>
                <div><label for="insurance-end-date"> ุงูุชูุงุก ุงูุชุฃููู:</label><input type="date" id="insurance-end-date" data-key="insuranceEnd"></div>
            </div>

            <div class="action-buttons">
                <button type="button" id="save-data" onclick="saveCarData()">+ ุญูุธ ุงูุจูุงูุงุช</button>
                <button type="button" id="update-data" onclick="updateCarData()" disabled>ุชุนุฏูู ุงูุจูุงูุงุช </button>
                <button type="button" id="delete-data" onclick="deleteCarData()" disabled>ุญุฐู ุงูุจูุงูุงุช</button>
                <button type="button" onclick="clearForm()">ูุณุญ ุงููููุฐุฌ</button>
            </div>
        </fieldset>

        ---

        <fieldset id="oil-fieldset" style="display: none;">
            <legend>๐ข๏ธ ุซุงููุงู : ุณุฌู ุชุบููุฑ ุงูุฒูุช</legend>
            <div id="oil-input-fields" style="border: 1px dashed #555; padding: 15px; margin-bottom: 20px;">
                <h4>ุฃุฏุฎู ุนูููุฉ ุบูุงุฑ ุฒูุช ุฌุฏูุฏุฉ</h4>
                <div class="form-group">
                    <div><label for="oil-date">ุชุงุฑูุฎ ุงูุนูููุฉ:</label><input type="date" id="oil-date" data-oil-key="date" required></div>
                    <div><label for="oil-type">ุงุณู ุงูุฒูุช:</label><input type="text" id="oil-type" data-oil-key="oilType"></div>
                    <div><label for="air-filter">ููุชุฑ ุงูููุงุก:</label><select id="air-filter" data-oil-key="airFilter"><option value="ูู ูุชู">ูู ูุชู ุงูุชุบููุฑ</option><option value="ุชู ุงูุชุบููุฑ">ุชู ุงูุชุบููุฑ</option><option value="ุชู ุงูุชูุธูู">ุชู ุงูุชูุธูู</option></select></div>
                    <div><label for="engine-filter">ููุชุฑ ููููุฉ (ุฒูุช):</label><select id="engine-filter" data-oil-key="engineFilter"><option value="ูู ูุชู">ูู ูุชู ุงูุชุบููุฑ</option><option value="ุชู ุงูุชุบููุฑ">ุชู ุงูุชุบููุฑ</option></select></div>
                </div>
                <div class="form-group">
                    <div><label for="brake-fluid">ุฒูุช ุงููุฑุงูู:</label><select id="brake-fluid" data-oil-key="brakeFluid"><option value="ูู ูุชู">ูู ูุชู ุงูุชุบููุฑ</option><option value="ุชู ุงููุญุต">ุชู ุงููุญุต</option><option value="ุชู ุงูุชุบููุฑ">ุชู ุงูุชุบููุฑ</option></select></div>
                    <div><label for="water">ููุงู ููุณูุงุฑุฉ:</label><select id="water" data-oil-key="water"><option value="ูู ูุชู">ูู ูุชู ุงูุชุบููุฑ</option><option value="ุชู ุงููุญุต">ุชู ุงููุญุต</option><option value="ุชู ุงูุฅุถุงูุฉ">ุชู ุงูุฅุถุงูุฉ</option></select></div>
                    <div><label for="steering-fluid">ุฒูุช ุงูุฏุฑูุณููู:</label><select id="steering-fluid" data-oil-key="steeringFluid"><option value="ูู ูุชู">ูู ูุชู ุงูุชุบููุฑ</option><option value="ุชู ุงููุญุต">ุชู ุงููุญุต</option><option value="ุชู ุงูุชุบููุฑ">ุชู ุงูุชุบููุฑ</option></select></div>
                    <div><label for="gear-oil">ุฒูุช ุงูููุฑ:</label><select id="gear-oil" data-oil-key="gearOil"><option value="ูู ูุชู">ูู ูุชู ุงูุชุบููุฑ</option><option value="ุชู ุงููุญุต">ุชู ุงููุญุต</option><option value="ุชู ุงูุชุบููุฑ">ุชู ุงูุชุบููุฑ</option></select></div>
                </div>
                <div class="form-group">
                    <div><label for="current-reading">ูุฑุงุกุฉ ุงูุนุฏุงุฏ ุงูุญุงููุฉ (ูู):</label><input type="number" id="current-reading" data-oil-key="currentReading" min="0" required></div>
                    <div><label for="oil-validity">ุตูุงุญูุฉ ุงูุฒูุช (ูู):</label><input type="number" id="oil-validity" data-oil-key="oilValidity" min="1000"></div>
                    <div><label for="next-change-at">ุงูุบูุงุฑ ุงููุงุฏู ุณูููู ุนูู ูุฑุงุกุฉ:</label><input type="number" id="next-change-at" data-oil-key="nextChangeAt" min="0" readonly></div>
                </div>
                <div class="form-group full-width">
                    <div class="full-width"><label for="oil-notes">ููุงุญุธุงุช:</label><textarea id="oil-notes" data-oil-key="notes"></textarea></div>
                </div>
                <div class="action-buttons">
                    <button type="button" id="add-oil-record" onclick="addOilRecord()" disabled>+ ุญูุธ ุงูุจูุงูุงุช  </button>
                    <button type="button" id="save-oil-edit" onclick="saveOilEdit()">๐พ ุญูุธ ุงูุจูุงูุงุช</button>
                    <button type="button" onclick="clearOilForm()">ูุณุญ ุงูุจูุงูุงุช</button>
                </div>
            </div>

            <h4 style="margin-top: 10px;">ุณุฌูุงุช ุงูุฒููุช ููุฐู ุงูุณูุงุฑุฉ</h4>
            <div id="oil-records-output" class="records-container">
                </div>
        </fieldset>
        
        ---

        <fieldset id="maintenance-fieldset" style="display: none;">
            <legend>๐ง ุซุงูุซุงู : ุณุฌู ุงูุตูุงูุฉ ูุงูุฅุตูุงุญุงุช</legend>

            <div id="maintenance-input-fields" style="border: 1px dashed #555; padding: 15px; margin-bottom: 20px;">
                <h4>ุฅุฏุฎู ูุฑุช ุตูุงูุฉ ุฌุฏูุฏ</h4>
                
                <div class="form-group">
                    <div>
                        <label for="maintenance-date">ุชุงุฑูุฎ ุงูุนูููุฉ:</label>
                        <input type="date" id="maintenance-date" data-maint-key="date" required>
                    </div>
                    <div>
                        <label for="maintenance-type">ููุน ุงูุตูุงูุฉ:</label>
                        <select id="maintenance-type" data-maint-key="type" required>
                            <option value="">-- ุงุฎุชุฑ ููุน ุงูุตูุงูุฉ --</option>
                            <option value="ุชุบููุฑ ุฒูุช ุงููุญุฑู ูุงูููุชุฑ">ุชุบููุฑ ุฒูุช ุงููุญุฑู ูุงูููุชุฑ</option>
                            <option value="ุงุณุชุจุฏุงู ููุชุฑ ุงูููุงุก (ุงููุญุฑู)">ุงุณุชุจุฏุงู ููุชุฑ ุงูููุงุก (ุงููุญุฑู)</option>
                            <option value="ุงุณุชุจุฏุงู ููุชุฑ ููุงุก ุงูููุตูุฑุฉ (ุงููููู)">ุงุณุชุจุฏุงู ููุชุฑ ููุงุก ุงูููุตูุฑุฉ (ุงููููู)</option>
                            <option value="ุงุณุชุจุฏุงู ููุชุฑ ุงููููุฏ">ุงุณุชุจุฏุงู ููุชุฑ ุงููููุฏ</option>
                            <option value="ุงุณุชุจุฏุงู ุดูุนุงุช ุงูุฅุดุนุงู (ุงูุจูุงุฌู)">ุงุณุชุจุฏุงู ุดูุนุงุช ุงูุฅุดุนุงู (ุงูุจูุงุฌู)</option>
                            <option value="ูุญุต ูุชูุธูู ุฃุทุฑุงู ุงูุจุทุงุฑูุฉ ูุงุฎุชุจุงุฑ ููุชูุง">ูุญุต ูุชูุธูู ุฃุทุฑุงู ุงูุจุทุงุฑูุฉ ูุงุฎุชุจุงุฑ ููุชูุง</option>
                            <option value="ุงุณุชุจุฏุงู ุงูุจุทุงุฑูุฉ">ุงุณุชุจุฏุงู ุงูุจุทุงุฑูุฉ</option>
                            <option value="ูุญุต ูุชุนุจุฆุฉ ุณุงุฆู ุงูุชุจุฑูุฏ (ุฑุฏูุชุฑ)">ูุญุต ูุชุนุจุฆุฉ ุณุงุฆู ุงูุชุจุฑูุฏ (ุฑุฏูุชุฑ)</option>
                            <option value="ูุญุต ูุชุนุจุฆุฉ ุณุงุฆู ุงููุฑุงูู">ูุญุต ูุชุนุจุฆุฉ ุณุงุฆู ุงููุฑุงูู</option>
                            <option value="ูุญุต ูุชุนุจุฆุฉ ุณุงุฆู ูุงูู ุงูุญุฑูุฉ (ุงูุฌูุฑ)">ูุญุต ูุชุนุจุฆุฉ ุณุงุฆู ูุงูู ุงูุญุฑูุฉ (ุงูุฌูุฑ)</option>
                            <option value="ูุญุต ูุชุนุจุฆุฉ ุณุงุฆู ุงููุณุงุญุงุช">ูุญุต ูุชุนุจุฆุฉ ุณุงุฆู ุงููุณุงุญุงุช</option>
                            <option value="ูุญุต ูุณุชูู ุฒูุช ุงูุฏูุฑูุณ">ูุญุต ูุณุชูู ุฒูุช ุงูุฏูุฑูุณ</option>
                            <option value="ูุญุต ุถุบุท ุงูุฅุทุงุฑุงุช ูุชุนุฏููู">ูุญุต ุถุบุท ุงูุฅุทุงุฑุงุช ูุชุนุฏููู</option>
                            <option value="ูุญุต ุญุณุงุณุงุช ุงูุฅุทุงุฑุงุช ูุชุบููุฑูุง">ูุญุต ุญุณุงุณุงุช ุงูุฅุทุงุฑุงุช ูุชุบููุฑูุง</option>
                            <option value="ูุญุต ุนูู ุฏุนุณุฉ ุงูุฅุทุงุฑุงุช ูุญุงูุฉ ุงูุชุขูู">ูุญุต ุนูู ุฏุนุณุฉ ุงูุฅุทุงุฑุงุช ูุญุงูุฉ ุงูุชุขูู</option>
                            <option value="ููุงูุจุฉ ุงูุฅุทุงุฑุงุช ูุชุบููุฑ ููุงูุนูุง">ููุงูุจุฉ ุงูุฅุทุงุฑุงุช ูุชุบููุฑ ููุงูุนูุง</option>
                            <option value="ูุญุต ุงูุฅุทุงุฑ ุงูุงุญุชูุงุทู ูุงููุนุฏุงุช">ูุญุต ุงูุฅุทุงุฑ ุงูุงุญุชูุงุทู ูุงููุนุฏุงุช</option>
                            <option value="ุงุณุชุจุฏุงู ูุญูุงุช ุงููุฑุงูู ูุฎุฑุท ุงูููุจุงุช">ุงุณุชุจุฏุงู ูุญูุงุช ุงููุฑุงูู ูุฎุฑุท ุงูููุจุงุช</option>
                            <option value="ูุญุต ุงูุณููุฑ ูุงุณุชุจุฏุงููุง">ูุญุต ุงูุณููุฑ ูุงุณุชุจุฏุงููุง</option>
                            <option value="ูุญุต ุงูุฃุถูุงุก ุงูุฎุงุฑุฌูุฉ ูุงูุฏุงุฎููุฉ">ูุญุต ุงูุฃุถูุงุก ุงูุฎุงุฑุฌูุฉ ูุงูุฏุงุฎููุฉ</option>
                            <option value="ุงุณุชุจุฏุงู ูุณุงุญุงุช ุงูุฒุฌุงุฌ ุงูุฃูุงูู ูุงูุฎููู">ุงุณุชุจุฏุงู ูุณุงุญุงุช ุงูุฒุฌุงุฌ ุงูุฃูุงูู ูุงูุฎููู</option>
                            <option value="ุณููุฑุฉ ูุจููุฉ">ุณููุฑุฉ ูุจููุฉ</option>
                            <option value="ุดูุท ุงูุจูุฏู">ุดูุท ุงูุจูุฏู</option>
                            <option value="ูุญุต ูุชุดุบูู ุงูุจูู (Horn)">ูุญุต ูุชุดุบูู ุงูุจูู (Horn)</option>
                            <option value="ูุญุต ุนูู ุฃุญุฒูุฉ ุงูุฃูุงู">ูุญุต ุนูู ุฃุญุฒูุฉ ุงูุฃูุงู</option>
                            <option value="ูุญุต ููุจููุชุฑ ุงูุณูุงุฑุฉ (ูุญุต ุงูุฃุนุทุงู)">ูุญุต ููุจููุชุฑ ุงูุณูุงุฑุฉ (ูุญุต ุงูุฃุนุทุงู)</option>
                            <option value="ุฎุฏูุงุช ุงูุชูููู ูุงูุชุจุฑูุฏ">ุฎุฏูุงุช ุงูุชุชูููู ูุงูุชุจุฑูุฏ</option>
                            <option value="ุชูุธูู ูุธุงู ุญุงููุงุช ุงููููุฏ (ุงูุจุฎุงุฎุงุช)">ุชูุธูู ูุธุงู ุญุงููุงุช ุงููููุฏ (ุงูุจุฎุงุฎุงุช)</option>
                            <option value="ุงูุฃุฐุฑุนุฉ ูุงูููุตุงุช">ุงูุฃุฐุฑุนุฉ ูุงูููุตุงุช</option>
                            <option value="ุฃุนุทุงู ุงูููููุฉ">ุฃุนุทุงู ุงูููููุฉ</option>
                            <option value="ุชูุธูู ูุชูููุน ุงููุตุงุจูุญ ุงูุฃูุงููุฉ">ุชูุธูู ูุชูููุน ุงููุตุงุจูุญ ุงูุฃูุงููุฉ</option>
                            <option value="ูุญุต ุดุงูู ููุง ูุจู ุงูุณูุฑ">ูุญุต ุดุงูู ููุง ูุจู ุงูุณูุฑ (Pre-trip inspection)</option>
                            <option value="ุบุณูู ูุชูุธูู ุงูุณูุงุฑุฉ">ุบุณูู ูุชูุธูู ุงูุณูุงุฑุฉ</option>
                            <option value="ุฒุฌุงุฌ ุงูุฒุฌุงุฌ">ุฒุฌุงุฌ ุงูุฒุฌุงุฌ</option>
                            <option value="ุชูุฌูุฏ ุงูููุงุนุฏ">ุชูุฌูุฏ ุงูููุงุนุฏ</option>
                            <option value="ุงููููุงูููุง">ุงููููุงูููุง</option>
                            <option value="ุงูููุฑุจุงุก">ุงูููุฑุจุงุก</option>
                            <option value="ุงูููุจุฑ ุฌูุงุณ">ุงูููุจุฑ ุฌูุงุณ</option>
                            <option value="ูุทุน ุบูุงุฑ">ูุทุน ุบูุงุฑ</option>
                        </select>
                    </div>
                </div>

                <div class="form-group full-width">
                    <div class="full-width">
                        <label for="maintenance-details">ุจูุงู ุจุงูุตูุงูุฉ (ูุง ุชู ุนููู):</label>
                        <textarea id="maintenance-details" data-maint-key="details" required></textarea>
                    </div>
                </div>

                <div class="form-group">
                    <div>
                        <label for="parts-cost">ุชูููุฉ ูุทุน ุงูุบูุงุฑ (SAR):</label>
                        <input type="number" id="parts-cost" data-maint-key="partsCost" min="0" step="0.01" oninput="calculateTotal()">
                    </div>
                    <div>
                        <label for="labor-cost">ุชูููุฉ ุงูุตูุงูุฉ (ุฃุฌุฑุฉ ุงููุฏ ุงูุนุงููุฉ) (SAR):</label>
                        <input type="number" id="labor-cost" data-maint-key="laborCost" min="0" step="0.01" oninput="calculateTotal()">
                    </div>
                    <div>
                        <label for="total-cost">ูุฌููุน ุงูุชูููุฉ (SAR):</label>
                        <input type="number" id="total-cost" data-maint-key="totalCost" min="0" step="0.01" readonly>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button type="button" id="add-maintenance-record" onclick="addMaintenanceRecord()" disabled>+ ุญูุธ ุงูุจูุงูุงุช</button>
                    <button type="button" id="save-maintenance-edit" onclick="saveMaintenanceEdit()">๐พ ุญูุธ ุชุนุฏูู ุงูุณุฌู</button>
                    <button type="button" onclick="clearMaintenanceForm()">ูุณุญ ุงูุจูุงูุงุช</button>
                </div>
            </div>

            <h4 style="margin-top: 10px;">ุณุฌูุงุช ุงูุตูุงูุฉ ูุงูุฅุตูุงุญุงุช ููุฐู ุงูุณูุงุฑุฉ</h4>
            <div id="maintenance-records-output" class="records-container">
                </div>
        </fieldset>
        
        ---

        <fieldset id="parts-fieldset" style="display: none;">
            <legend>๐ฉ ุฑุงุจุนุงู : ุณุฌู ููุงุชูุฑ ูุทุน ุงูุบูุงุฑ</legend>
            <div id="parts-input-fields" style="border: 1px dashed #555; padding: 15px; margin-bottom: 20px;">
                <h4>ุฃุฏุฎู ูุงุชูุฑุฉ ูุทุน ุบูุงุฑ ุฌุฏูุฏุฉ</h4>
                
                <div class="form-group">
                    <div><label for="parts-date">ุชุงุฑูุฎ ุงูุดุฑุงุก:</label><input type="date" id="parts-date" data-parts-key="date" required></div>
                    <div><label for="parts-store-name">ุงุณู ุงููุญู:</label><input type="text" id="parts-store-name" data-parts-key="storeName" required></div>
                    <div><label for="parts-store-phone">ุฑูู ุงููุงุชู:</label><input type="number" id="parts-store-phone" data-parts-key="storePhone" min="0"></div>
                    <div>
                        <label for="parts-oem-number">ุฑูู ุงููุทุนุฉ (OEM Number):</label>
                        <input type="text" id="parts-oem-number" data-parts-key="oemNumber" oninput="generateBarcode()">
                    </div>
                    <div>
                        <label for="parts-barcode">ุจุงุฑููุฏ ุงููุทุนุฉ:</label>
                        <input type="text" id="parts-barcode" data-parts-key="barcode" placeholder="ุณูุชู ุชูููุฏู ุชููุงุฆูุงู" readonly>
                    </div>
                </div>

                <div class="form-group full-width">
                    <div class="full-width" style="text-align: center; border: 1px dashed #777; padding: 10px; margin-top: 10px;">
                        <label>ุนุฑุถ ุงูุจุงุฑููุฏ (SVG):</label>
                        <div id="barcode-display-area" style="margin-top: 10px;">
                            <p style="color: #ccc;">(ูุธูุฑ ุงูุจุงุฑููุฏ ููุง ุจุนุฏ ุฅุฏุฎุงู ุฑูู ุงููุทุนุฉ)</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-group full-width">
                    <div class="full-width"><label for="parts-description">ุงููุตู ูุงูุงุณู:</label><textarea id="parts-description" data-parts-key="description" required></textarea></div>
                </div>

                <div class="form-group full-width">
                    <div class="full-width"><label for="parts-warranty">ุงูุถูุงู:</label><textarea id="parts-warranty" data-parts-key="warranty"></textarea></div>
                </div>

                <div class="form-group">
                    <div>
                        <label for="parts-cost-per-unit">ุชูููุฉ ุงููุทุนุฉ ุงููุงุญุฏุฉ (SAR):</label>
                        <input type="number" id="parts-cost-per-unit" data-parts-key="costPerUnit" min="0" step="0.01" oninput="calculatePartsTotal()">
                    </div>
                    <div>
                        <label for="parts-quantity">ุนุฏุฏ ุงููุทุน:</label>
                        <input type="number" id="parts-quantity" data-parts-key="quantity" min="1" step="1" oninput="calculatePartsTotal()" required>
                    </div>
                    <div>
                        <label for="parts-tax-rate">ุงูุถุฑูุจุฉ ุงูููุถุงูุฉ (ูช):</label>
                        <input type="number" id="parts-tax-rate" data-parts-key="taxRate" min="0" step="0.01" value="15" oninput="calculatePartsTotal()">
                    </div>
                    <div>
                        <label for="parts-total-cost">ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ (SAR):</label>
                        <input type="number" id="parts-total-cost" data-parts-key="totalCost" min="0" step="0.01" readonly>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button type="button" id="add-parts-record" onclick="addPartsRecord()" disabled>+ ุญูุธ ุงูุจูุงูุงุช</button>
                    <button type="button" id="save-parts-edit" onclick="savePartsEdit()">๐พ ุญูุธ ุชุนุฏูู ุงูุณุฌู</button>
                    <button type="button" onclick="clearPartsForm()">ูุณุญ ุงูุจูุงูุงุช</button>
                </div>
            </div>

            <h4 style="margin-top: 10px;">ุณุฌูุงุช ูุทุน ุงูุบูุงุฑ ููุฐู ุงูุณูุงุฑุฉ</h4>
            <div id="parts-records-output" class="records-container">
                </div>
        </fieldset>

        ---

        <fieldset id="reports-fieldset" style="display: none;">
            <legend>๐ ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช</legend>

            <div style="border: 1px dashed #555; padding: 15px; margin-bottom: 20px;">
                <h4>๐   ุชูุฑูุฑ ุชุบููุฑ ุงูุฒูุช</h4>
                <div class="form-group">
                    <div>
                        <label for="oil-report-month">ุงุฎุชุฑ ุงูุดูุฑ:</label>
                        <select id="oil-report-month">
                            <option value="">ูู ุงูุดููุฑ</option>
                            <option value="01">ููุงูุฑ</option><option value="02">ูุจุฑุงูุฑ</option><option value="03">ูุงุฑุณ</option>
                            <option value="04">ุฃุจุฑูู</option><option value="05">ูุงูู</option><option value="06">ููููู</option>
                            <option value="07">ููููู</option><option value="08">ุฃุบุณุทุณ</option><option value="09">ุณุจุชูุจุฑ</option>
                            <option value="10">ุฃูุชูุจุฑ</option><option value="11">ููููุจุฑ</option><option value="12">ุฏูุณูุจุฑ</option>
                        </select>
                    </div>
                    <div>
                        <label for="oil-report-year">ุงุฎุชุฑ ุงูุณูุฉ:</label>
                        <select id="oil-report-year" required></select>
                    </div>
                </div>
                <div class="report-buttons">
                    <button type="button" id="print-oil-report-filtered" onclick="printFilteredReport('oil')">ุนุฑุถ ูุทุจุงุนุฉ ุงูุชูุฑูุฑ (ุดูุฑู/ุณููู)</button>
                    <button type="button" class="full-report-btn" onclick="printFullReport('oil')">ุทุจุงุนุฉ ุชูุฑูุฑ ุงูุฒููุช ุงููุงูู</button>
                </div>
            </div>

            <div style="border: 1px dashed #555; padding: 15px; margin-bottom: 20px;">
                <h4>๐   ุชูุฑูุฑ ุงูุตูุงูุฉ ูุงูุฅุตูุงุญุงุช</h4>
                <div class="form-group">
                    <div>
                        <label for="maintenance-report-month">ุงุฎุชุฑ ุงูุดูุฑ (ุงุฎุชูุงุฑู):</label>
                        <select id="maintenance-report-month">
                            <option value="">ูู ุงูุดููุฑ</option>
                            <option value="01">ููุงูุฑ</option><option value="02">ูุจุฑุงูุฑ</option><option value="03">ูุงุฑุณ</option>
                            <option value="04">ุฃุจุฑูู</option><option value="05">ูุงูู</option><option value="06">ููููู</option>
                            <option value="07">ููููู</option><option value="08">ุฃุบุณุทุณ</option><option value="09">ุณุจุชูุจุฑ</option>
                            <option value="10">ุฃูุชูุจุฑ</option><option value="11">ููููุจุฑ</option><option value="12">ุฏูุณูุจุฑ</option>
                        </select>
                    </div>
                    <div>
                        <label for="maintenance-report-year">ุงุฎุชุฑ ุงูุณูุฉ:</label>
                        <select id="maintenance-report-year" required></select>
                    </div>
                </div>
                <div class="report-buttons">
                    <button type="button" id="print-maintenance-report-filtered" onclick="printFilteredReport('maintenance')">ุนุฑุถ ูุทุจุงุนุฉ ุงูุชูุฑูุฑ (ุดูุฑู/ุณููู)</button>
                    <button type="button" class="full-report-btn" onclick="printFullReport('maintenance')">ุทุจุงุนุฉ ุชูุฑูุฑ ุงูุตูุงูุฉ ุงููุงูู</button>
                </div>
            </div>

            <div style="border: 1px dashed #555; padding: 15px;">
                <h4>๐   ุชูุฑูุฑ ุณุฌู ูุทุน ุงูุบูุงุฑ</h4>
                <div class="form-group">
                    <div>
                        <label for="parts-report-month">ุงุฎุชุฑ ุงูุดูุฑ (ุงุฎุชูุงุฑู):</label>
                        <select id="parts-report-month">
                            <option value="">ูู ุงูุดููุฑ</option>
                            <option value="01">ููุงูุฑ</option><option value="02">ูุจุฑุงูุฑ</option><option value="03">ูุงุฑุณ</option>
                            <option value="04">ุฃุจุฑูู</option><option value="05">ูุงูู</option><option value="06">ููููู</option>
                            <option value="07">ููููู</option><option value="08">ุฃุบุณุทุณ</option><option value="09">ุณุจุชูุจุฑ</option>
                            <option value="10">ุฃูุชูุจุฑ</option><option value="11">ููููุจุฑ</option><option value="12">ุฏูุณูุจุฑ</option>
                        </select>
                    </div>
                    <div>
                        <label for="parts-report-year">ุงุฎุชุฑ ุงูุณูุฉ:</label>
                        <select id="parts-report-year" required></select>
                    </div>
                </div>
                <div class="report-buttons">
                    <button type="button" id="print-parts-report-filtered" onclick="printFilteredReport('parts')">ุนุฑุถ ูุทุจุงุนุฉ ุงูุชูุฑูุฑ (ุดูุฑู/ุณููู)</button>
                    <button type="button" class="full-report-btn" onclick="printFullReport('parts')">ุทุจุงุนุฉ ุชูุฑูุฑ ูุทุน ุงูุบูุงุฑ ุงููุงูู</button>
                </div>
            </div>
            
        </fieldset>

        <button type="button" id="print-records" onclick="prepareAndPrint()" disabled>๐จ๏ธ ุทุจุงุนุฉ ุณุฌูุงุช ุงูุณูุงุฑุฉ ุงูุญุงููุฉ (A4 ุฃููู)</button>

    </form>

    ---

    <div id="print-area" class="print-area">
        <h2 class="print-only" id="print-car-header"></h2>
        
        <h4 class="print-only">๐ ุจูุงูุงุช ุงูุณูุงุฑุฉ ุงูุฃุณุงุณูุฉ</h4>
        <div id="print-car-data" class="print-only"></div>

        <div id="print-oil-report" class="print-only">
            <h4 id="oil-report-title" class="print-only">๐ข๏ธ ุชูุฑูุฑ ุชุบููุฑ ุงูุฒููุช (ุงูุดุงูู)</h4>
            <div id="print-oil-records" class="records-container print-only"></div>
        </div>

        <div id="print-maintenance-report" class="print-only">
            <h4 id="maintenance-report-title" class="print-only">๐ง ุชูุฑูุฑ ุงูุตูุงูุฉ ูุงูุฅุตูุงุญุงุช (ุงูุดุงูู)</h4>
            <div id="print-maintenance-records" class="records-container print-only"></div>
        </div>

        <div id="print-parts-report" class="print-only">
            <h4 id="parts-report-title" class="print-only">๐ฉ ุชูุฑูุฑ ุณุฌู ูุทุน ุงูุบูุงุฑ (ุงูุดุงูู)</h4>
            <div id="print-parts-records" class="records-container print-only"></div>
        </div>
    </div>

    ุญููู ุงูููููุฉ ูุญููุธุฉ @ ุชุฑูู ุงูุณุงูู 2025

    <script>
        // ููุงุชูุญ ุชุฎุฒูู ุงูุจูุงูุงุช
        const CAR_STORAGE_KEY = 'carDataRecords';
        const OIL_STORAGE_KEY = 'oilRecords';
        const MAINTENANCE_STORAGE_KEY = 'maintenanceRecords';
        const PARTS_STORAGE_KEY = 'partsRecords'; 
        
        // ูุชุบูุฑุงุช ุนุงูููุฉ ูุญูุธ ID ุงูุณุฌู ุงูุฐู ูุชู ุชุนุฏููู ุญุงููุงู
        let currentEditingOilRecordId = null; 
        let currentEditingMaintenanceRecordId = null; 
        let currentEditingPartsRecordId = null; 

        // ุญููู ุงููุณู ุงูุฃูู 
        const dataFields = [
            { key: 'serial', label: 'ุงูุฑูู ุงูุชุณูุณูู' },
            { key: 'make', label: 'ุงูุตูุน' },
            { key: 'model', label: 'ุงูุทุฑุงุฒ' },
            { key: 'year', label: 'ุงูููุฏูู' },
            { key: 'color', label: 'ุงูููู' },
            { key: 'recommendedOilType', label: 'ููุน ุงูุฒูุช ุงูููุตู ุจู' },
            { key: 'oilQuantity', label: 'ูููุฉ ุงูุฒูุช (ุนูุจุฉ)' },
            { key: 'regExpiry', label: 'ุงูุชูุงุก ุงูุงุณุชูุงุฑุฉ' },
            { key: 'insuranceCompany', label: 'ุดุฑูุฉ ุงูุชุฃููู' },
            { key: 'insuranceStart', label: 'ุชุงุฑูุฎ ุจุฏุก ุงูุชุฃููู' }, 
            { key: 'insuranceEnd', label: 'ุงูุชูุงุก ุงูุชุฃููู' }
        ];

        // ุญููู ุงููุณู ุงูุซุงูู
        const oilFields = [
            { key: 'date', label: 'ุชุงุฑูุฎ ุงูุนูููุฉ' },
            { key: 'oilType', label: 'ููุน ุงูุฒูุช' },
            { key: 'currentReading', label: 'ูุฑุงุกุฉ ุงูุนุฏุงุฏ' },
            { key: 'nextChangeAt', label: 'ุงูุบูุงุฑ ุงููุงุฏู' },
            { key: 'airFilter', label: 'ููุชุฑ ุงูููุงุก' },
            { key: 'engineFilter', label: 'ููุชุฑ ููููุฉ' },
            { key: 'brakeFluid', label: 'ุฒูุช ุงููุฑุงูู' },
            { key: 'water', label: 'ููุงู' },
            { key: 'gearOil', label: 'ุฒูุช ุงูููุฑ' },
            { key: 'notes', label: 'ููุงุญุธุงุช' }
        ];

        // ุญููู ุงููุณู ุงูุซุงูุซ
        const maintenanceFields = [
            { key: 'date', label: 'ุชุงุฑูุฎ ุงูุตูุงูุฉ' },
            { key: 'type', label: 'ููุน ุงูุตูุงูุฉ' },
            { key: 'details', label: 'ุงูุชูุงุตูู' },
            { key: 'partsCost', label: 'ุชูููุฉ ุงููุทุน (SAR)' },
            { key: 'laborCost', label: 'ุฃุฌุฑุฉ ุงูุนูู (SAR)' },
            { key: 'totalCost', label: 'ุงููุฌููุน (SAR)' }
        ];
        
        // ๐ก ุญููู ุงููุณู ุงูุฑุงุจุน (ูุทุน ุงูุบูุงุฑ)
        const partsFields = [
            { key: 'date', label: 'ุชุงุฑูุฎ ุงูุดุฑุงุก' },
            { key: 'storeName', label: 'ุงุณู ุงููุญู' },
            { key: 'storePhone', label: 'ุฑูู ุงููุงุชู' },
            { key: 'oemNumber', label: 'ุฑูู ุงููุทุนุฉ (OEM)' },
            { key: 'barcode', label: 'ุจุงุฑููุฏ ุงููุทุนุฉ' }, 
            { key: 'description', label: 'ุงููุตู ูุงูุงุณู' },
            { key: 'warranty', label: 'ุงูุถูุงู' },
            { key: 'costPerUnit', label: 'ุชูููุฉ ุงููุญุฏุฉ' },
            { key: 'quantity', label: 'ุงูุนุฏุฏ' },
            { key: 'taxRate', label: 'ุงูุถุฑูุจุฉ (ูช)' },
            { key: 'totalCost', label: 'ุงูุฅุฌูุงูู (SAR)' }
        ];

        
        // ูุชุบูุฑ ุนุงููู ูุชุฎุฒูู ุณุฌูุงุช ุงูุณูุงุฑุฉ ุงูุญุงููุฉ
        let currentCarOilRecords = [];
        let currentCarMaintenanceRecords = [];
        let currentCarPartsRecords = []; 
        
        // ----------------------------------------------------
        // ูุธุงุฆู ุนุงูุฉ ูุดุชุฑูุฉ
        // ----------------------------------------------------
        
        // ๐ก ุฏุงูุฉ ุชูุณูู ุงูุชุงุฑูุฎ ุงููุทููุจุฉ dd/mm/yyyy
        function formatDate(dateString) {
            if (!dateString) return '-';
            // dateString is expected to be 'DD-MM-YYYY' from the input type="date"
            return dateString.replace(/-/g, '/'); 
        }

        function getCarRecords() {
            const records = localStorage.getItem(CAR_STORAGE_KEY);
            return records ? JSON.parse(records) : {};
        }

        function getOilRecords() {
            const records = localStorage.getItem(OIL_STORAGE_KEY);
            return records ? JSON.parse(records) : {};
        }

        function getMaintenanceRecords() {
            const records = localStorage.getItem(MAINTENANCE_STORAGE_KEY);
            return records ? JSON.parse(records) : {};
        }
        
        // ๐ก ุฏุงูุฉ ุงูุญุตูู ุนูู ุณุฌูุงุช ูุทุน ุงูุบูุงุฑ
        function getPartsRecords() {
            const records = localStorage.getItem(PARTS_STORAGE_KEY);
            return records ? JSON.parse(records) : {};
        }

        // ุฏุงูุฉ ุญุณุงุจ ุงูุฅุฌูุงูู ููุณู ุงูุตูุงูุฉ
        function calculateTotal() {
            const partsCost = parseFloat(document.getElementById('parts-cost').value) || 0;
            const laborCost = parseFloat(document.getElementById('labor-cost').value) || 0;
            const totalCostInput = document.getElementById('total-cost');
            totalCostInput.value = (partsCost + laborCost).toFixed(2);
        }

        // ๐ก ุฏุงูุฉ ุญุณุงุจ ุงูุฅุฌูุงูู ููุณู ูุทุน ุงูุบูุงุฑ
        function calculatePartsTotal() {
            const costPerUnit = parseFloat(document.getElementById('parts-cost-per-unit').value) || 0;
            const quantity = parseFloat(document.getElementById('parts-quantity').value) || 0;
            const taxRate = parseFloat(document.getElementById('parts-tax-rate').value) || 0;
            const totalCostInput = document.getElementById('parts-total-cost');

            const subTotal = costPerUnit * quantity;
            const taxAmount = subTotal * (taxRate / 100);
            const total = subTotal + taxAmount;

            totalCostInput.value = total.toFixed(2);
        }

        // ๐ก ุฏุงูุฉ ุชูููุฏ ุงูุจุงุฑููุฏ ุงูุญูููู ุจุงุณุชุฎุฏุงู ููุชุจุฉ JsBarcode
        function generateBarcode() {
            const oemNumberInput = document.getElementById('parts-oem-number');
            const barcodeInput = document.getElementById('parts-barcode');
            const displayArea = document.getElementById('barcode-display-area');
            const oemValue = oemNumberInput.value.trim();

            barcodeInput.value = oemValue; // ูุจูู ุงูุญูู ุงููุตู ูุญูู ุงูุฑูู ุงูุชุณูุณูู ููุฑุฌุน

            displayArea.innerHTML = ''; // ูุณุญ ุงูููุทูุฉ

            if (oemValue.length > 0) {
                // ุฅูุดุงุก ุนูุตุฑ SVG ูุคูุช ูุชูููุฏ ุงูุจุงุฑููุฏ ุจุฏุงุฎูู
                const tempSvg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                // ุชุบููุฑ ุงูู id ููููู ุซุงุจุชูุง ููููุฒูุง ูุชูููู JsBarcode
                tempSvg.id = "temp-barcode-svg"; 
                // ูุฌุจ ุฅุถุงูุชู ุฅูู DOM ูุคูุชุงู ูุชุชููู JsBarcode ูู ุงูุนูู
                displayArea.appendChild(tempSvg); 

                try {
                    // ุชูููุฏ ุงูุจุงุฑููุฏ ุจุงุณุชุฎุฏุงู Code 128
                    JsBarcode("#temp-barcode-svg", oemValue, {
                        format: "CODE128", 
                        displayValue: false, // ูุง ูุนุฑุถ ุงููููุฉ ุฃุณูู ุงูุจุงุฑููุฏ ูู ุงูุฌุฏูู
                        text: oemValue,
                        margin: 0, // ุฅุฒุงูุฉ ุงููุงูุด ูููุงุฆู ุงูุฌุฏูู
                        height: 40, // ุชูููู ุงูุงุฑุชูุงุน ูููุงุฆู ุงูุฌุฏูู
                        width: 2 // ุณูุงูุฉ ุงูุฎุท
                    });
                    
                    // ุงูุญุตูู ุนูู ููุฏ ุงูู SVG ุงููุชููุฏ
                    const svgHtml = tempSvg.outerHTML; 
                    
                    // ุชุญุฏูุซ ููุทูุฉ ุงูุนุฑุถ ุจููุฏ SVG (ูููุนุงููุฉ)
                    displayArea.innerHTML = svgHtml;
                    
                    // ููุงุญุธุฉ: ุญูุธ ููุฏ SVG ุณูุชู ูู addPartsRecord ู savePartsEdit ุจูุงุกู ุนูู ูุญุชูู displayArea
                    
                } catch(e) {
                    displayArea.innerHTML = `<p style="color: #dc3545;">โ๏ธ ุฎุทุฃ: ูููุฉ ุงูุจุงุฑููุฏ ุบูุฑ ุตุงูุญุฉ ุฃู ูู ูุชู ุชุญููู ููุชุจุฉ JsBarcode.</p>`;
                }
            } else {
                displayArea.innerHTML = '<p style="color: #ccc;">(ูุธูุฑ ุงูุจุงุฑููุฏ ููุง ุจุนุฏ ุฅุฏุฎุงู ุฑูู ุงููุทุนุฉ)</p>';
            }
        }


        // ----------------------------------------------------
        // ูุธุงุฆู ุชููุฆุฉ ุญููู ุงูุณูุฉ (Report Year Initialization)
        // ----------------------------------------------------
        function populateYearSelectors() {
            const currentYear = new Date().getFullYear();
            const startYear = 2000;
            const selectors = [
                document.getElementById('oil-report-year'),
                document.getElementById('maintenance-report-year'),
                document.getElementById('parts-report-year') 
            ];

            selectors.forEach(selector => {
                selector.innerHTML = '';
                // ูุชู ุฅุถุงูุฉ ุงูุณูุฉ ุงูุญุงููุฉ ูุงูุณููุงุช ุงููุงุฏูุฉ ุชููุงุฆูุงู
                for (let year = currentYear + 1; year >= startYear; year--) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    selector.appendChild(option);
                    if (year === currentYear) {
                        selector.value = currentYear; // ุชุญุฏูุฏ ุงูุณูุฉ ุงูุญุงููุฉ ููููุฉ ุงูุชุฑุงุถูุฉ
                    }
                }
            });
        }


        // ----------------------------------------------------
        // ูุธุงุฆู ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงูุณูุงุฑุงุช (ุงููุณู ุงูุฃูู)
        // ----------------------------------------------------

        function populateCarSelector() {
            const records = getCarRecords();
            const selector = document.getElementById('car-selector');
            const selectedValue = selector.value;
            selector.innerHTML = '<option value="">-- ุงุฎุชุฑ ุฃู ุฃุฏุฎู ุจูุงูุงุช ุฌุฏูุฏุฉ --</option>';

            // ูุชู ุนุฑุถ ุงูุตูุน ูุงูุทุฑุงุฒ ููุท
            Object.keys(records).forEach(vin => {
                const option = document.createElement('option');
                option.value = vin; // ูุง ูุฒุงู ูุญูุธ ุงูู VIN ููููุฉ ูุชุญุฏูุฏ ุงูุณูุงุฑุฉ
                option.textContent = records[vin].make + ' ' + records[vin].model;
                selector.appendChild(option);
            });
            selector.value = selectedValue;
        }

        function loadCarData(vin) {
            const records = getCarRecords();
            const data = records[vin];
            const isSelected = !!data;
            
            // ุชุนุจุฆุฉ ุจูุงูุงุช ุงูุณูุงุฑุฉ
            dataFields.map(f => f.key).forEach(key => {
                const inputElement = document.querySelector(`[data-key="${key}"]`);
                if (inputElement) {
                    inputElement.value = isSelected ? data[key] : '';
                    if (key === 'serial') {
                        inputElement.readOnly = isSelected;
                    }
                }
            });
            
            // ุชูุนูู/ุชุนุทูู ุฃุฒุฑุงุฑ ุงููุณู ุงูุฃูู
            document.getElementById('update-data').disabled = !isSelected;
            document.getElementById('delete-data').disabled = !isSelected;
            document.getElementById('save-data').disabled = isSelected;
            
            // ุงูุชุญูู ุจุธููุฑ ุงูุฃูุณุงู ุงูุฃุฎุฑู
            document.getElementById('oil-fieldset').style.display = isSelected ? 'block' : 'none';
            document.getElementById('maintenance-fieldset').style.display = isSelected ? 'block' : 'none';
            document.getElementById('parts-fieldset').style.display = isSelected ? 'block' : 'none'; 
            document.getElementById('reports-fieldset').style.display = isSelected ? 'block' : 'none'; 
            
            // ุชูุนูู/ุชุนุทูู ุฃุฒุฑุงุฑ ุงูุฃูุณุงู ู ุชุญุฏูุซ ุงูุนุฑุถ
            document.getElementById('add-oil-record').disabled = !isSelected;
            document.getElementById('add-maintenance-record').disabled = !isSelected;
            document.getElementById('add-parts-record').disabled = !isSelected; 
            
            // ุชุญุฏูุซ ุณุฌูุงุช ุงูุณูุงุฑุฉ ุงูุญุงููุฉ
            const oilRecords = getOilRecords();
            currentCarOilRecords = oilRecords[vin] || [];
            
            const maintenanceRecords = getMaintenanceRecords();
            currentCarMaintenanceRecords = maintenanceRecords[vin] || [];

            const partsRecords = getPartsRecords(); 
            currentCarPartsRecords = partsRecords[vin] || [];
            
            // ุนุฑุถ ุงูุณุฌูุงุช ูุชุตููุฑ ุญููู ุงูุจุญุซ 
            renderOilRecords(currentCarOilRecords);
            clearOilForm();
            
            renderMaintenanceRecords(currentCarMaintenanceRecords);
            clearMaintenanceForm();

            renderPartsRecords(currentCarPartsRecords); 
            clearPartsForm();
        }

        function saveCarData() {
            const serialInput = document.getElementById('car-serial');
            const vin = serialInput.value.trim();
            if (!vin) { alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงูุฑูู ุงูุชุณูุณูู (VIN).'); return; }

            let records = getCarRecords();
            if (records[vin]) { alert('ูุฐุง ุงูุฑูู ุงูุชุณูุณูู ูุณุฌู ูุณุจูุงู! ุงุณุชุฎุฏู ุฒุฑ "ุชุนุฏูู ุงูุจูุงูุงุช".'); return; }
            
            let newRecord = {};
            dataFields.map(f => f.key).forEach(key => {
                const inputElement = document.querySelector(`[data-key="${key}"]`);
                newRecord[key] = inputElement ? inputElement.value : '';
            });

            records[vin] = newRecord;
            localStorage.setItem(CAR_STORAGE_KEY, JSON.stringify(records));
            alert('ุชู ุญูุธ ุจูุงูุงุช ุงูุณูุงุฑุฉ ุจูุฌุงุญ.');
            populateCarSelector();
            document.getElementById('car-selector').value = vin;
            loadCarData(vin);
        }

        function updateCarData() {
            const serialInput = document.getElementById('car-serial');
            const vin = serialInput.value.trim();
            if (!vin || document.getElementById('car-selector').value !== vin) { return; }
            
            let records = getCarRecords();
            let updatedRecord = {};
            dataFields.map(f => f.key).forEach(key => {
                const inputElement = document.querySelector(`[data-key="${key}"]`);
                updatedRecord[key] = inputElement ? inputElement.value : '';
            });

            records[vin] = updatedRecord;
            localStorage.setItem(CAR_STORAGE_KEY, JSON.stringify(records));
            alert('ุชู ุชุนุฏูู ุจูุงูุงุช ุงูุณูุงุฑุฉ ุจูุฌุงุญ.');
            populateCarSelector();
            loadCarData(vin); 
        }

        function deleteCarData() {
            const selector = document.getElementById('car-selector');
            const vin = selector.value;
            
            if (!vin) { return; }
            if (confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุจูุงูุงุช ุงูุณูุงุฑุฉ ุฐุงุช ุงูุฑูู ุงูุชุณูุณูู ${vin} ูุณุฌูุงุชูุงุ`)) {
                let records = getCarRecords();
                delete records[vin];
                localStorage.setItem(CAR_STORAGE_KEY, JSON.stringify(records));
                
                let oilRecords = getOilRecords();
                delete oilRecords[vin];
                localStorage.setItem(OIL_STORAGE_KEY, JSON.stringify(oilRecords));
                
                let maintenanceRecords = getMaintenanceRecords();
                delete maintenanceRecords[vin];
                localStorage.setItem(MAINTENANCE_STORAGE_KEY, JSON.stringify(maintenanceRecords));

                let partsRecords = getPartsRecords(); 
                delete partsRecords[vin];
                localStorage.setItem(PARTS_STORAGE_KEY, JSON.stringify(partsRecords));

                alert('ุชู ุญุฐู ุจูุงูุงุช ุงูุณูุงุฑุฉ ูุณุฌูุงุชูุง ุจูุฌุงุญ.');
                clearForm(); 
                populateCarSelector();
            }
        }
        
        function clearForm() {
            dataFields.map(f => f.key).forEach(key => {
                const inputElement = document.querySelector(`[data-key="${key}"]`);
                if (inputElement) {
                    inputElement.value = '';
                    if (key === 'serial') {
                        inputElement.readOnly = false;
                    }
                }
            });
            document.getElementById('car-selector').value = '';
            document.getElementById('update-data').disabled = true;
            document.getElementById('delete-data').disabled = true;
            document.getElementById('save-data').disabled = false;
            
            document.getElementById('oil-fieldset').style.display = 'none';
            document.getElementById('maintenance-fieldset').style.display = 'none';
            document.getElementById('parts-fieldset').style.display = 'none'; 
            document.getElementById('reports-fieldset').style.display = 'none';
            
            clearOilForm();
            clearMaintenanceForm();
            clearPartsForm(); 

            document.getElementById('oil-records-output').innerHTML = '<p style="text-align: center; color: #777;">ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุณูุงุฑุฉ ูุนุฑุถ ุณุฌูุงุช ุฒููุชูุง.</p>';
            document.getElementById('maintenance-records-output').innerHTML = '<p style="text-align: center; color: #777;">ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุณูุงุฑุฉ ูุนุฑุถ ุณุฌูุงุช ุตูุงูุชูุง.</p>';
            document.getElementById('parts-records-output').innerHTML = '<p style="text-align: center; color: #777;">ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุณูุงุฑุฉ ูุนุฑุถ ุณุฌูุงุช ูุทุน ุงูุบูุงุฑ.</p>'; 
        }

        // ----------------------------------------------------
        // ูุธุงุฆู ุฅุฏุงุฑุฉ ุณุฌูุงุช ุงูุฒููุช (ุงููุณู ุงูุซุงูู)
        // ----------------------------------------------------
        
        function calculateNextChange() {
            const readingInput = document.getElementById('current-reading');
            const validityInput = document.getElementById('oil-validity');
            const nextChangeInput = document.getElementById('next-change-at');

            const currentReading = parseFloat(readingInput.value) || 0;
            const oilValidity = parseFloat(validityInput.value) || 0;

            nextChangeInput.value = (currentReading > 0 && oilValidity > 0) ? (currentReading + oilValidity) : '';
        }
        
        function addOilRecord() {
            const currentVin = document.getElementById('car-selector').value;
            
            const date = document.getElementById('oil-date').value;
            if (!currentVin || !date || !document.getElementById('current-reading').value) { return; }

            let oilRecords = getOilRecords();
            // ุงุณุชุฎุฏุงู Date.now() ูู ID ูุฑูุฏ
            let newRecord = { id: Date.now() }; 

            oilFields.forEach(field => {
                const inputElement = document.querySelector(`[data-oil-key="${field.key}"]`);
                newRecord[field.key] = inputElement ? inputElement.value : '';
            });
            // ุงูุชุฃูุฏ ูู ุฃู ุญูู "ุงูุบูุงุฑ ุงููุงุฏู" ูุชู ุญุณุงุจู ุนูุฏ ุงูุฅุถุงูุฉ
            calculateNextChange();
            newRecord.nextChangeAt = document.getElementById('next-change-at').value;
            // ุญูุธ oilValidity ูุฏููุงู ูุฃูู ููุณ ุถูู ุงูู oilFields ุงูููุฑุฑุฉ ูู ุงูุชุนุจุฆุฉ
            newRecord.oilValidity = document.getElementById('oil-validity').value;


            if (!oilRecords[currentVin]) { oilRecords[currentVin] = []; }
            oilRecords[currentVin].push(newRecord);
            localStorage.setItem(OIL_STORAGE_KEY, JSON.stringify(oilRecords));
            
            alert('ุชู ุฅุถุงูุฉ ุณุฌู ุงูุฒูุช ุจูุฌุงุญ ูู ' + currentVin);
            
            currentCarOilRecords = oilRecords[currentVin];
            clearOilForm();
            renderOilRecords(currentCarOilRecords); 
        }

        function editOilRecord(recordId) {
            const record = currentCarOilRecords.find(r => r.id === parseInt(recordId));
            if (!record) return;

            // 1. ุชุนุจุฆุฉ ุงูุญููู ุจุงูุจูุงูุงุช ุงูุญุงููุฉ
            oilFields.forEach(field => {
                const inputElement = document.querySelector(`[data-oil-key="${field.key}"]`);
                if (inputElement) {
                    inputElement.value = record[field.key] || '';
                }
            });
            // ูุฌุจ ุชุนุจุฆุฉ ุญูู oilValidity ูุฏููุงู 
            document.getElementById('oil-validity').value = record.oilValidity || '';

            // 2. ุชุญุฏูุซ ูุชุบูุฑ ุงูุชุนุฏูู ุงูุนุงููู ูุฅุธูุงุฑ ุฒุฑ ุงูุญูุธ
            currentEditingOilRecordId = parseInt(recordId);
            document.getElementById('add-oil-record').style.display = 'none';
            document.getElementById('save-oil-edit').style.display = 'inline-block';
            
            // 3. ุงูุชูุฑูุฑ ููุฃุนูู ูุฑุคูุฉ ุญููู ุงูุฅุฏุฎุงู
            document.getElementById('oil-fieldset').scrollIntoView({ behavior: 'smooth' });
        }

        function saveOilEdit() {
            const currentVin = document.getElementById('car-selector').value;
            if (!currentVin || !currentEditingOilRecordId) return;

            let oilRecords = getOilRecords();
            let records = oilRecords[currentVin];
            
            // ุงูุจุญุซ ุนู ูุคุดุฑ ุงูุณุฌู ุงูุฐู ูุชู ุชุนุฏููู
            const recordIndex = records.findIndex(r => r.id === currentEditingOilRecordId);

            if (recordIndex > -1) {
                // ุชุญุฏูุซ ุงูุจูุงูุงุช ูู ุญููู ุงูุฅุฏุฎุงู
                calculateNextChange(); // ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุบูุงุฑ ุงููุงุฏู
                
                let updatedRecord = { id: currentEditingOilRecordId };
                oilFields.forEach(field => {
                    const inputElement = document.querySelector(`[data-oil-key="${field.key}"]`);
                    updatedRecord[field.key] = inputElement ? inputElement.value : '';
                });
                // ุญูุธ oilValidity ูุฏููุงู
                updatedRecord.oilValidity = document.getElementById('oil-validity').value;

                records[recordIndex] = updatedRecord;
                localStorage.setItem(OIL_STORAGE_KEY, JSON.stringify(oilRecords));
                
                alert('ุชู ุชุนุฏูู ุณุฌู ุงูุฒูุช ุจูุฌุงุญ.');
                
                currentCarOilRecords = records;
                renderOilRecords(currentCarOilRecords);
                clearOilForm();
            }
        }

        function deleteOilRecord(recordId) {
            const currentVin = document.getElementById('car-selector').value;
            if (!currentVin) return;

            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุณุฌู ุงูุฒูุช ูุฐุงุ ุณูุชู ุญุฐูู ุจุดูู ุฏุงุฆู.')) {
                let oilRecords = getOilRecords();
                let records = oilRecords[currentVin];

                // ุชุตููุฉ ุงูุณุฌูุงุช ูุฅุฒุงูุฉ ุงูุณุฌู ุงููุทููุจ
                const newRecords = records.filter(r => r.id !== parseInt(recordId));
                oilRecords[currentVin] = newRecords;
                localStorage.setItem(OIL_STORAGE_KEY, JSON.stringify(oilRecords));
                
                alert('ุชู ุญุฐู ุณุฌู ุงูุฒูุช ุจูุฌุงุญ.');
                
                currentCarOilRecords = newRecords;
                renderOilRecords(currentCarOilRecords);
                
                // ุฅุฐุง ูุงู ุงูุณุฌู ุงููุญุฐูู ูู ุงูุฐู ูุชู ุชุนุฏููู ุญุงููุงูุ ูุชู ูุณุญ ุงููููุฐุฌ
                if (currentEditingOilRecordId === parseInt(recordId)) {
                    clearOilForm();
                }
            }
        }


        function clearOilForm() {
            document.getElementById('oil-input-fields').querySelectorAll('input, select, textarea').forEach(element => {
                if (element.tagName === 'SELECT') {
                    // ุฅุนุงุฏุฉ ูููุฉ ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ุฅูู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ
                    if (element.id === 'air-filter' || element.id === 'engine-filter' || element.id === 'brake-fluid' || element.id === 'water' || element.id === 'steering-fluid' || element.id === 'gear-oil') {
                         element.value = 'ูู ูุชู';
                    } else {
                        element.value = element.options[0].value;
                    }
                } else if (element.type === 'number' || element.type === 'text' || element.type === 'date' || element.tagName === 'TEXTAREA') {
                    element.value = '';
                }
            });
            
            // ุฅุนุงุฏุฉ ุงููููุฐุฌ ูุญุงูุฉ ุงูุฅุถุงูุฉ
            currentEditingOilRecordId = null;
            document.getElementById('add-oil-record').style.display = 'inline-block';
            document.getElementById('save-oil-edit').style.display = 'none';
        }
        
        function renderOilRecords(recordsToRender, containerId = 'oil-records-output', isPrint = false) {
            const vin = document.getElementById('car-selector').value;
            const container = document.getElementById(containerId);

            if (!vin) {
                container.innerHTML = `<p style="text-align: center; color: #777;">ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุณูุงุฑุฉ ูุนุฑุถ ุณุฌูุงุช ุฒููุชูุง.</p>`;
                return;
            }
            if (recordsToRender.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: ${isPrint ? '#000' : '#dc3545'};">ูุง ุชูุฌุฏ ุณุฌูุงุช ููุฏุฎูุฉ ${isPrint ? 'ูู ูุฐุง ุงูุชูุฑูุฑ' : 'ููุฐู ุงูุณูุงุฑุฉ'}.</p>`;
                return;
            }

            recordsToRender.sort((a, b) => new Date(b.date) - new Date(a.date));

            let tableHTML = '<table id="oil-records-table" class="car-records-table">';
            tableHTML += '<thead><tr>';
            oilFields.forEach(field => { tableHTML += `<th>${field.label}</th>`; });
            if (!isPrint) { tableHTML += `<th>ุงูุฅุฌุฑุงุกุงุช</th>`; } // ุนููุฏ ุงูุฅุฌุฑุงุกุงุช ูุธูุฑ ููุท ูู ุดุงุดุฉ ุงูุฅุฏุฎุงู
            tableHTML += '</tr></thead>';

            tableHTML += '<tbody>';
            recordsToRender.forEach(record => {
                tableHTML += '<tr>';
                oilFields.forEach(field => { 
                    // ๐ก ุชุทุจูู ุชูุณูู ุงูุชุงุฑูุฎ ุงููุทููุจ
                    if (field.key === 'date') {
                        tableHTML += `<td>${formatDate(record[field.key])}</td>`;
                    } else {
                        tableHTML += `<td>${record[field.key] || '-'}</td>`;
                    }
                });
                // ุนููุฏ ุงูุฅุฌุฑุงุกุงุช ุจุฃุฒุฑุงุฑ ุงูุชุนุฏูู ูุงูุญุฐู
                if (!isPrint) {
                    tableHTML += `<td class="actions">
                                    <button type="button" class="edit-btn" onclick="editOilRecord(${record.id})">ุชุนุฏูู</button>
                                    <button type="button" class="delete-btn" onclick="deleteOilRecord(${record.id})">ุญุฐู</button>
                                </td>`;
                }
                tableHTML += '</tr>';
            });
            tableHTML += '</tbody></table>';
            container.innerHTML = tableHTML;
        }

        // ----------------------------------------------------
        // ูุธุงุฆู ุฅุฏุงุฑุฉ ุณุฌูุงุช ุงูุตูุงูุฉ (ุงููุณู ุงูุซุงูุซ)
        // ----------------------------------------------------

        function addMaintenanceRecord() {
            const currentVin = document.getElementById('car-selector').value;
            
            const date = document.getElementById('maintenance-date').value;
            const details = document.getElementById('maintenance-details').value;
            if (!currentVin || !date || !details) { alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงูุชุงุฑูุฎ ูุงูุชูุงุตูู ุฃููุงู.'); return; }

            let maintenanceRecords = getMaintenanceRecords();
            let newRecord = { id: Date.now() };

            calculateTotal();

            maintenanceFields.forEach(field => {
                const inputElement = document.querySelector(`[data-maint-key="${field.key}"]`);
                newRecord[field.key] = inputElement ? inputElement.value : '';
            });

            if (!maintenanceRecords[currentVin]) { maintenanceRecords[currentVin] = []; }
            maintenanceRecords[currentVin].push(newRecord);
            localStorage.setItem(MAINTENANCE_STORAGE_KEY, JSON.stringify(maintenanceRecords));
            
            alert('ุชู ุฅุถุงูุฉ ุณุฌู ุงูุตูุงูุฉ ุจูุฌุงุญ.');
            
            currentCarMaintenanceRecords = maintenanceRecords[currentVin];
            clearMaintenanceForm();
            renderMaintenanceRecords(currentCarMaintenanceRecords);
        }

        function editMaintenanceRecord(recordId) {
            const record = currentCarMaintenanceRecords.find(r => r.id === parseInt(recordId));
            if (!record) return;

            // 1. ุชุนุจุฆุฉ ุงูุญููู ุจุงูุจูุงูุงุช ุงูุญุงููุฉ
            maintenanceFields.forEach(field => {
                const inputElement = document.querySelector(`[data-maint-key="${field.key}"]`);
                if (inputElement) {
                     // ุงูุชุฃูุฏ ูู ุชุญููู ูููุฉ ุงูุชูููุฉ ุฅูู ุฑูููู ุนุดุฑููู ุนูุฏ ุงูุนุฑุถ
                    if (field.key === 'partsCost' || field.key === 'laborCost' || field.key === 'totalCost') {
                        inputElement.value = parseFloat(record[field.key]).toFixed(2);
                    } else {
                        inputElement.value = record[field.key] || '';
                    }
                }
            });

            // 2. ุชุญุฏูุซ ูุชุบูุฑ ุงูุชุนุฏูู ุงูุนุงููู ูุฅุธูุงุฑ ุฒุฑ ุงูุญูุธ
            currentEditingMaintenanceRecordId = parseInt(recordId);
            document.getElementById('add-maintenance-record').style.display = 'none';
            document.getElementById('save-maintenance-edit').style.display = 'inline-block';
            
            // 3. ุงูุชูุฑูุฑ ููุฃุนูู ูุฑุคูุฉ ุญููู ุงูุฅุฏุฎุงู
            document.getElementById('maintenance-fieldset').scrollIntoView({ behavior: 'smooth' });
        }
        
        function saveMaintenanceEdit() {
            const currentVin = document.getElementById('car-selector').value;
            if (!currentVin || !currentEditingMaintenanceRecordId) return;

            let maintenanceRecords = getMaintenanceRecords();
            let records = maintenanceRecords[currentVin];
            
            // ุงูุจุญุซ ุนู ูุคุดุฑ ุงูุณุฌู ุงูุฐู ูุชู ุชุนุฏููู
            const recordIndex = records.findIndex(r => r.id === currentEditingMaintenanceRecordId);

            if (recordIndex > -1) {
                // ุชุญุฏูุซ ุงูุจูุงูุงุช ูู ุญููู ุงูุฅุฏุฎุงู
                calculateTotal();
                
                let updatedRecord = { id: currentEditingMaintenanceRecordId };
                maintenanceFields.forEach(field => {
                    const inputElement = document.querySelector(`[data-maint-key="${field.key}"]`);
                    updatedRecord[field.key] = inputElement ? inputElement.value : '';
                });
                
                records[recordIndex] = updatedRecord;
                localStorage.setItem(MAINTENANCE_STORAGE_KEY, JSON.stringify(maintenanceRecords));
                
                alert('ุชู ุชุนุฏูู ุณุฌู ุงูุตูุงูุฉ ุจูุฌุงุญ.');
                
                currentCarMaintenanceRecords = records;
                renderMaintenanceRecords(currentCarMaintenanceRecords);
                clearMaintenanceForm();
            }
        }
        
        function deleteMaintenanceRecord(recordId) {
            const currentVin = document.getElementById('car-selector').value;
            if (!currentVin) return;

            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุณุฌู ุงูุตูุงูุฉ ูุฐุงุ ุณูุชู ุญุฐูู ุจุดูู ุฏุงุฆู.')) {
                let maintenanceRecords = getMaintenanceRecords();
                let records = maintenanceRecords[currentVin];

                // ุชุตููุฉ ุงูุณุฌูุงุช ูุฅุฒุงูุฉ ุงูุณุฌู ุงููุทููุจ
                const newRecords = records.filter(r => r.id !== parseInt(recordId));
                maintenanceRecords[currentVin] = newRecords;
                localStorage.setItem(MAINTENANCE_STORAGE_KEY, JSON.stringify(maintenanceRecords));
                
                alert('ุชู ุญุฐู ุณุฌู ุงูุตูุงูุฉ ุจูุฌุงุญ.');
                
                currentCarMaintenanceRecords = newRecords;
                renderMaintenanceRecords(currentCarMaintenanceRecords);
                
                // ุฅุฐุง ูุงู ุงูุณุฌู ุงููุญุฐูู ูู ุงูุฐู ูุชู ุชุนุฏููู ุญุงููุงูุ ูุชู ูุณุญ ุงููููุฐุฌ
                if (currentEditingMaintenanceRecordId === parseInt(recordId)) {
                    clearMaintenanceForm();
                }
            }
        }

        function clearMaintenanceForm() {
            document.getElementById('maintenance-input-fields').querySelectorAll('input, select, textarea').forEach(element => {
                if (element.tagName === 'SELECT') {
                    element.value = element.options[0].value;
                } else if (element.type === 'number' || element.type === 'text' || element.type === 'date') {
                    element.value = '';
                }
            });
            calculateTotal();
            
            // ุฅุนุงุฏุฉ ุงููููุฐุฌ ูุญุงูุฉ ุงูุฅุถุงูุฉ
            currentEditingMaintenanceRecordId = null;
            document.getElementById('add-maintenance-record').style.display = 'inline-block';
            document.getElementById('save-maintenance-edit').style.display = 'none';
        }

        function renderMaintenanceRecords(recordsToRender, containerId = 'maintenance-records-output', isPrint = false) {
            const vin = document.getElementById('car-selector').value;
            const container = document.getElementById(containerId);

            if (!vin) {
                container.innerHTML = `<p style="text-align: center; color: #777;">ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุณูุงุฑุฉ ูุนุฑุถ ุณุฌูุงุช ุตูุงูุชูุง.</p>`;
                return;
            }
            if (recordsToRender.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: ${isPrint ? '#000' : '#dc3545'};">ูุง ุชูุฌุฏ ุณุฌูุงุช ููุฏุฎูุฉ ${isPrint ? 'ูู ูุฐุง ุงูุชูุฑูุฑ' : 'ููุฐู ุงูุณูุงุฑุฉ'}.</p>`;
                return;
            }

            recordsToRender.sort((a, b) => new Date(b.date) - new Date(a.date));

            let tableHTML = '<table id="maintenance-records-table" class="car-records-table">';
            tableHTML += '<thead><tr>';
            maintenanceFields.forEach(field => { tableHTML += `<th>${field.label}</th>`; });
            if (!isPrint) { tableHTML += `<th>ุงูุฅุฌุฑุงุกุงุช</th>`; } // ุนููุฏ ุงูุฅุฌุฑุงุกุงุช ูุธูุฑ ููุท ูู ุดุงุดุฉ ุงูุฅุฏุฎุงู
            tableHTML += '</tr></thead>';

            tableHTML += '<tbody>';
            recordsToRender.forEach(record => {
                tableHTML += '<tr>';
                maintenanceFields.forEach(field => {
                    if (field.key === 'partsCost' || field.key === 'laborCost' || field.key === 'totalCost') {
                        // ุนุฑุถ ูููุฉ ุงูุชูููุฉ ุจุฑูููู ุนุดุฑููู
                        tableHTML += `<td>${parseFloat(record[field.key]).toFixed(2) || '0.00'}</td>`;
                    } else if (field.key === 'date') { // ๐ก ุชุทุจูู ุชูุณูู ุงูุชุงุฑูุฎ ุงููุทููุจ
                         tableHTML += `<td>${formatDate(record[field.key])}</td>`;
                    } else {
                        tableHTML += `<td>${record[field.key] || '-'}</td>`;
                    }
                });
                // ุนููุฏ ุงูุฅุฌุฑุงุกุงุช ุจุฃุฒุฑุงุฑ ุงูุชุนุฏูู ูุงูุญุฐู
                if (!isPrint) {
                    tableHTML += `<td class="actions">
                                    <button type="button" class="edit-btn" onclick="editMaintenanceRecord(${record.id})">ุชุนุฏูู</button>
                                    <button type="button" class="delete-btn" onclick="deleteMaintenanceRecord(${record.id})">ุญุฐู</button>
                                </td>`;
                }
                tableHTML += '</tr>';
            });
            tableHTML += '</tbody></table>';

            container.innerHTML = tableHTML;
        }

        // ----------------------------------------------------
        // ๐ก ูุธุงุฆู ุฅุฏุงุฑุฉ ุณุฌูุงุช ูุทุน ุงูุบูุงุฑ (ุงููุณู ุงูุฑุงุจุน ุงูุฌุฏูุฏ)
        // ----------------------------------------------------

        function addPartsRecord() {
            const currentVin = document.getElementById('car-selector').value;
            
            const date = document.getElementById('parts-date').value;
            const storeName = document.getElementById('parts-store-name').value;
            if (!currentVin || !date || !storeName) { alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุชุงุฑูุฎ ุงูุดุฑุงุก ูุงุณู ุงููุญู ุฃููุงู.'); return; }

            let partsRecords = getPartsRecords();
            let newRecord = { id: Date.now() };

            calculatePartsTotal();

            partsFields.forEach(field => {
                const inputElement = document.querySelector(`[data-parts-key="${field.key}"]`);
                newRecord[field.key] = inputElement ? inputElement.value : '';
            });
            
            // ุงูุชุฃูุฏ ูู ุฃู ุงูุชูุงููู ูุงูุชูุงุตูู ุฑูููุฉ
            newRecord.costPerUnit = parseFloat(newRecord.costPerUnit).toFixed(2);
            newRecord.quantity = parseInt(newRecord.quantity);
            newRecord.taxRate = parseFloat(newRecord.taxRate).toFixed(2);
            newRecord.totalCost = parseFloat(newRecord.totalCost).toFixed(2);

            // ๐ก ุงูุชุนุฏูู ุฑูู 1: ุชุฎุฒูู ููุฏ SVG ุงููุชููุฏ ุถูู ุงูุณุฌู
            const barcodeDisplay = document.getElementById('barcode-display-area');
            const svgElement = barcodeDisplay.querySelector('#temp-barcode-svg');
            
            // ุฅุฐุง ูุงู SVG ููุฌูุฏุงูุ ูู ุจุชุฎุฒูู ููุฏ HTML ุงูุฎุงุต ุจู
            newRecord.barcodeSvg = svgElement ? svgElement.outerHTML : ''; 

            if (!partsRecords[currentVin]) { partsRecords[currentVin] = []; }
            partsRecords[currentVin].push(newRecord);
            localStorage.setItem(PARTS_STORAGE_KEY, JSON.stringify(partsRecords));
            
            alert('ุชู ุฅุถุงูุฉ ุณุฌู ูุทุน ุงูุบูุงุฑ ุจูุฌุงุญ.');
            
            currentCarPartsRecords = partsRecords[currentVin];
            clearPartsForm();
            renderPartsRecords(currentCarPartsRecords);
        }

        function editPartsRecord(recordId) {
            const record = currentCarPartsRecords.find(r => r.id === parseInt(recordId));
            if (!record) return;

            // 1. ุชุนุจุฆุฉ ุงูุญููู ุจุงูุจูุงูุงุช ุงูุญุงููุฉ
            partsFields.forEach(field => {
                const inputElement = document.querySelector(`[data-parts-key="${field.key}"]`);
                if (inputElement) {
                     // ุงูุชุฃูุฏ ูู ุชุญููู ูููุฉ ุงูุชูููุฉ ุฅูู ุฑูููู ุนุดุฑููู ุนูุฏ ุงูุนุฑุถ
                    if (field.key === 'costPerUnit' || field.key === 'totalCost' || field.key === 'taxRate') {
                        inputElement.value = parseFloat(record[field.key]).toFixed(2);
                    } else if (field.key === 'quantity') {
                        inputElement.value = parseInt(record[field.key]);
                    } 
                    else {
                        inputElement.value = record[field.key] || '';
                    }
                }
            });

            // 2. ุชุญุฏูุซ ูุชุบูุฑ ุงูุชุนุฏูู ุงูุนุงููู ูุฅุธูุงุฑ ุฒุฑ ุงูุญูุธ
            currentEditingPartsRecordId = parseInt(recordId);
            document.getElementById('add-parts-record').style.display = 'none';
            document.getElementById('save-parts-edit').style.display = 'inline-block';
            
            // ๐ก ุชูููุฏ ุงูุจุงุฑููุฏ ูููุทุนุฉ ุงูุชู ูุชู ุชุนุฏูููุง
            generateBarcode(); 
            
            // 3. ุงูุชูุฑูุฑ ููุฃุนูู ูุฑุคูุฉ ุญููู ุงูุฅุฏุฎุงู
            document.getElementById('parts-fieldset').scrollIntoView({ behavior: 'smooth' });
        }
        
        function savePartsEdit() {
            const currentVin = document.getElementById('car-selector').value;
            if (!currentVin || !currentEditingPartsRecordId) return;

            let partsRecords = getPartsRecords();
            let records = partsRecords[currentVin];
            
            // ุงูุจุญุซ ุนู ูุคุดุฑ ุงูุณุฌู ุงูุฐู ูุชู ุชุนุฏููู
            const recordIndex = records.findIndex(r => r.id === currentEditingPartsRecordId);

            if (recordIndex > -1) {
                // ุชุญุฏูุซ ุงูุจูุงูุงุช ูู ุญููู ุงูุฅุฏุฎุงู
                calculatePartsTotal();
                
                let updatedRecord = { id: currentEditingPartsRecordId };
                partsFields.forEach(field => {
                    const inputElement = document.querySelector(`[data-parts-key="${field.key}"]`);
                    updatedRecord[field.key] = inputElement ? inputElement.value : '';
                });
                
                // ุงูุชุฃูุฏ ูู ุฃู ุงูุชูุงููู ูุงูุชูุงุตูู ุฑูููุฉ
                updatedRecord.costPerUnit = parseFloat(updatedRecord.costPerUnit).toFixed(2);
                updatedRecord.quantity = parseInt(updatedRecord.quantity);
                updatedRecord.taxRate = parseFloat(updatedRecord.taxRate).toFixed(2);
                updatedRecord.totalCost = parseFloat(updatedRecord.totalCost).toFixed(2);

                // ๐ก ุงูุชุนุฏูู ุฑูู 2: ุชุญุฏูุซ ููุฏ SVG ุงููุชููุฏ ุถูู ุงูุณุฌู
                const barcodeDisplay = document.getElementById('barcode-display-area');
                const svgElement = barcodeDisplay.querySelector('#temp-barcode-svg');
                updatedRecord.barcodeSvg = svgElement ? svgElement.outerHTML : ''; 

                records[recordIndex] = updatedRecord;
                localStorage.setItem(PARTS_STORAGE_KEY, JSON.stringify(partsRecords));
                
                alert('ุชู ุชุนุฏูู ุณุฌู ูุทุน ุงูุบูุงุฑ ุจูุฌุงุญ.');
                
                currentCarPartsRecords = records;
                renderPartsRecords(currentCarPartsRecords);
                clearPartsForm();
            }
        }
        
        function deletePartsRecord(recordId) {
            const currentVin = document.getElementById('car-selector').value;
            if (!currentVin) return;

            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุณุฌู ูุทุน ุงูุบูุงุฑ ูุฐุงุ ุณูุชู ุญุฐูู ุจุดูู ุฏุงุฆู.')) {
                let partsRecords = getPartsRecords();
                let records = partsRecords[currentVin];

                // ุชุตููุฉ ุงูุณุฌูุงุช ูุฅุฒุงูุฉ ุงูุณุฌู ุงููุทููุจ
                const newRecords = records.filter(r => r.id !== parseInt(recordId));
                partsRecords[currentVin] = newRecords;
                localStorage.setItem(PARTS_STORAGE_KEY, JSON.stringify(partsRecords));
                
                alert('ุชู ุญุฐู ุณุฌู ูุทุน ุงูุบูุงุฑ ุจูุฌุงุญ.');
                
                currentCarPartsRecords = newRecords;
                renderPartsRecords(currentCarPartsRecords);
                
                // ุฅุฐุง ูุงู ุงูุณุฌู ุงููุญุฐูู ูู ุงูุฐู ูุชู ุชุนุฏููู ุญุงููุงูุ ูุชู ูุณุญ ุงููููุฐุฌ
                if (currentEditingPartsRecordId === parseInt(recordId)) {
                    clearPartsForm();
                }
            }
        }

        function clearPartsForm() {
            document.getElementById('parts-input-fields').querySelectorAll('input, select, textarea').forEach(element => {
                if (element.tagName === 'SELECT') {
                    element.value = element.options[0].value;
                } else if (element.type === 'number' || element.type === 'text' || element.type === 'date' || element.tagName === 'TEXTAREA') {
                    element.value = '';
                }
            });
            // ุฅุนุงุฏุฉ ูููุฉ ุงูุถุฑูุจุฉ ุงูุงูุชุฑุงุถูุฉ
            document.getElementById('parts-tax-rate').value = "15"; 
            calculatePartsTotal();
            
            // ๐ก ูุณุญ ููุทูุฉ ุนุฑุถ ุงูุจุงุฑููุฏ
            document.getElementById('barcode-display-area').innerHTML = '<p style="color: #ccc;">(ูุธูุฑ ุงูุจุงุฑููุฏ ููุง ุจุนุฏ ุฅุฏุฎุงู ุฑูู ุงููุทุนุฉ)</p>';
            
            // ุฅุนุงุฏุฉ ุงููููุฐุฌ ูุญุงูุฉ ุงูุฅุถุงูุฉ
            currentEditingPartsRecordId = null;
            document.getElementById('add-parts-record').style.display = 'inline-block';
            document.getElementById('save-parts-edit').style.display = 'none';
        }

        function renderPartsRecords(recordsToRender, containerId = 'parts-records-output', isPrint = false) {
            const vin = document.getElementById('car-selector').value;
            const container = document.getElementById(containerId);

            if (!vin) {
                container.innerHTML = `<p style="text-align: center; color: #777;">ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุณูุงุฑุฉ ูุนุฑุถ ุณุฌูุงุช ูุทุน ุงูุบูุงุฑ.</p>`;
                return;
            }
            if (recordsToRender.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: ${isPrint ? '#000' : '#dc3545'};">ูุง ุชูุฌุฏ ุณุฌูุงุช ููุฏุฎูุฉ ${isPrint ? 'ูู ูุฐุง ุงูุชูุฑูุฑ' : 'ููุฐู ุงูุณูุงุฑุฉ'}.</p>`;
                return;
            }

            recordsToRender.sort((a, b) => new Date(b.date) - new Date(a.date));

            let tableHTML = '<table id="parts-records-table" class="car-records-table">';
            tableHTML += '<thead><tr>';
            partsFields.forEach(field => { tableHTML += `<th>${field.label}</th>`; });
            if (!isPrint) { tableHTML += `<th>ุงูุฅุฌุฑุงุกุงุช</th>`; } // ุนููุฏ ุงูุฅุฌุฑุงุกุงุช ูุธูุฑ ููุท ูู ุดุงุดุฉ ุงูุฅุฏุฎุงู
            tableHTML += '</tr></thead>';

            tableHTML += '<tbody>';
            recordsToRender.forEach(record => {
                tableHTML += '<tr>';
                partsFields.forEach(field => {
                    if (field.key === 'costPerUnit' || field.key === 'totalCost') {
                        // ุนุฑุถ ูููุฉ ุงูุชูููุฉ ุจุฑูููู ุนุดุฑููู
                        tableHTML += `<td>${parseFloat(record[field.key]).toFixed(2) || '0.00'}</td>`;
                    } else if (field.key === 'taxRate') {
                        tableHTML += `<td>${parseFloat(record[field.key]).toFixed(2) || '0.00'}%</td>`;
                    } else if (field.key === 'barcode') { 
                        // ๐ก ุนุฑุถ ููุฏ SVG ุงููุฎุฒู ูุจุงุดุฑุฉู ูู ุนููุฏ ุงูุจุงุฑููุฏ
                        // ุฅุฐุง ูู ูุชู ุญูุธ ุงูู SVG (ุณุฌูุงุช ูุฏููุฉ)ุ ูุชู ุนุฑุถ ุงูุฑูู ุงููุตู ูุงุญุชูุงุทู
                        tableHTML += `<td>${record.barcodeSvg || record[field.key] || '-'}</td>`; 
                    } else if (field.key === 'date') { // ๐ก ุชุทุจูู ุชูุณูู ุงูุชุงุฑูุฎ ุงููุทููุจ
                        tableHTML += `<td>${formatDate(record[field.key])}</td>`;
                    } else {
                        tableHTML += `<td>${record[field.key] || '-'}</td>`;
                    }
                });
                // ุนููุฏ ุงูุฅุฌุฑุงุกุงุช ุจุฃุฒุฑุงุฑ ุงูุชุนุฏูู ูุงูุญุฐู
                if (!isPrint) {
                    tableHTML += `<td class="actions">
                                    <button type="button" class="edit-btn" onclick="editPartsRecord(${record.id})">ุชุนุฏูู</button>
                                    <button type="button" class="delete-btn" onclick="deletePartsRecord(${record.id})">ุญุฐู</button>
                                </td>`;
                }
                tableHTML += '</tr>';
            });
            tableHTML += '</tbody></table>';

            container.innerHTML = tableHTML;
        }


        // ----------------------------------------------------
        // ูุธุงุฆู ุงูุทุจุงุนุฉ ูุงูุชูุงุฑูุฑ (ุงููุณู ุงูุฎุงูุณ)
        // ----------------------------------------------------

        function getReportData(type, month, year) {
            let records;
            if (type === 'oil') records = currentCarOilRecords;
            else if (type === 'maintenance') records = currentCarMaintenanceRecords;
            else if (type === 'parts') records = currentCarPartsRecords; 
            else return [];

            if (!year) {
                return []; // ูุฌุจ ุงุฎุชูุงุฑ ุณูุฉ ููุชูุฑูุฑ ุงููููุชุฑ
            }

            // ุชุตููุฉ ุงูุณุฌูุงุช
            const filteredRecords = records.filter(record => {
                const recordDate = new Date(record.date);
                const recordYear = recordDate.getFullYear().toString();
                const recordMonth = (recordDate.getMonth() + 1).toString().padStart(2, '0'); // ุงูุดูุฑ ูู 1 ุฅูู 12

                const yearMatch = recordYear === year;
                const monthMatch = !month || recordMonth === month;

                return yearMatch && monthMatch;
            });

            return filteredRecords;
        }


        function printFilteredReport(type) {
            const vin = document.getElementById('car-selector').value;
            if (!vin) {
                alert('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุณูุงุฑุฉ ุฃููุงู.');
                return;
            }

            const month = document.getElementById(`${type}-report-month`).value;
            const year = document.getElementById(`${type}-report-year`).value;

            if (!year) {
                alert('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุงูุณูุฉ ูุชูุฑูุฑ ุงูุตูุงูุฉ.');
                return;
            }

            const reportRecords = getReportData(type, month, year);

            // ุฅุฎูุงุก ุฌููุน ุงูุชูุงุฑูุฑ
            document.getElementById('print-oil-report').style.display = 'none';
            document.getElementById('print-maintenance-report').style.display = 'none';
            document.getElementById('print-parts-report').style.display = 'none'; 
            
            const printReportContainer = document.getElementById(`print-${type}-report`);
            printReportContainer.style.display = 'block';

            // 1. ุชุญุฏูุซ ุงูุชุฑููุณุฉ ุงูุฑุฆูุณูุฉ ูุจูุงูุงุช ุงูุณูุงุฑุฉ (ุงููุณู ุงูุฃูู)
            updatePrintCarHeader(vin);

            // 2. ุชุญุฏูุซ ุนููุงู ุงูุชูุฑูุฑ
            const monthName = month ? document.getElementById(`${type}-report-month`).options[document.getElementById(`${type}-report-month`).selectedIndex].text : '';
            let finalTitle = '';

            if(type === 'oil') {
                finalTitle = month 
                    ? `๐ข๏ธ ุชูุฑูุฑ ุชุบููุฑ ุงูุฒููุช ูุดูุฑ ${monthName} ุนุงู ${year}`
                    : `๐ข๏ธ ุชูุฑูุฑ ุชุบููุฑ ุงูุฒููุช ูุนุงู ${year}`;
                renderOilRecords(reportRecords, 'print-oil-records', true);
            } else if (type === 'maintenance') {
                finalTitle = month 
                    ? `๐ง ุชูุฑูุฑ ุงูุตูุงูุฉ ูุงูุฅุตูุงุญุงุช ูุดูุฑ ${monthName} ุนุงู ${year}`
                    : `๐ง ุชูุฑูุฑ ุงูุตูุงูุฉ ูุงูุฅุตูุงุญุงุช ูุนุงู ${year}`;
                renderMaintenanceRecords(reportRecords, 'print-maintenance-records', true);
            } else if (type === 'parts') { 
                finalTitle = month 
                    ? `๐ฉ ุชูุฑูุฑ ุณุฌู ูุทุน ุงูุบูุงุฑ ูุดูุฑ ${monthName} ุนุงู ${year}`
                    : `๐ฉ ุชูุฑูุฑ ุณุฌู ูุทุน ุงูุบูุงุฑ ูุนุงู ${year}`;
                renderPartsRecords(reportRecords, 'print-parts-records', true);
            }

            document.getElementById(`${type}-report-title`).textContent = finalTitle;


            // 4. ุฅุทูุงู ุงูุทุจุงุนุฉ
            window.print();
        }

        function printFullReport(type) {
            const vin = document.getElementById('car-selector').value;
            if (!vin) {
                alert('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุณูุงุฑุฉ ุฃููุงู.');
                return;
            }

            let reportRecords;
            let reportTitle;
            
            if (type === 'oil') {
                reportRecords = currentCarOilRecords;
                reportTitle = '๐ข๏ธ ุชูุฑูุฑ ุชุบููุฑ ุงูุฒููุช ุงููุงูู';
                renderOilRecords(reportRecords, 'print-oil-records', true);
            } else if (type === 'maintenance') {
                reportRecords = currentCarMaintenanceRecords;
                reportTitle = '๐ง ุชูุฑูุฑ ุงูุตูุงูุฉ ูุงูุฅุตูุงุญุงุช ุงููุงูู';
                renderMaintenanceRecords(reportRecords, 'print-maintenance-records', true);
            } else if (type === 'parts') { 
                reportRecords = currentCarPartsRecords;
                reportTitle = '๐ฉ ุชูุฑูุฑ ุณุฌู ูุทุน ุงูุบูุงุฑ ุงููุงูู';
                renderPartsRecords(reportRecords, 'print-parts-records', true);
            } else {
                return;
            }

            // ุฅุฎูุงุก ุฌููุน ุงูุชูุงุฑูุฑ ูุง ุนุฏุง ุงููุทููุจ
            document.getElementById('print-oil-report').style.display = 'none';
            document.getElementById('print-maintenance-report').style.display = 'none';
            document.getElementById('print-parts-report').style.display = 'none'; 
            
            const printReportContainer = document.getElementById(`print-${type}-report`);
            printReportContainer.style.display = 'block';

            // 1. ุชุญุฏูุซ ุงูุชุฑููุณุฉ ุงูุฑุฆูุณูุฉ ูุจูุงูุงุช ุงูุณูุงุฑุฉ (ุงููุณู ุงูุฃูู)
            updatePrintCarHeader(vin);

            // 2. ุชุญุฏูุซ ุนููุงู ุงูุชูุฑูุฑ
            document.getElementById(`${type}-report-title`).textContent = reportTitle;
            
            // 4. ุฅุทูุงู ุงูุทุจุงุนุฉ
            window.print();
        }

        function updatePrintCarHeader(vin) {
            const carRecords = getCarRecords();
            const carData = carRecords[vin];

            // ุชุนุจุฆุฉ ุจูุงูุงุช ุงูุณูุงุฑุฉ ุงูุฃุณุงุณูุฉ ูููุทูุฉ ุงูุทุจุงุนุฉ
            let carDataHTML = '<ul style="list-style: none; padding: 0; margin-right: 0; display: flex; flex-wrap: wrap;">';
            dataFields.forEach(field => {
                let displayValue = carData[field.key] || '-';
                // ๐ก ุชุทุจูู ุชูุณูู ุงูุชุงุฑูุฎ ุงููุทููุจ ุนูู ุญููู ุงูุชูุงุฑูุฎ ูู ุงููุณู ุงูุฃูู
                if (['regExpiry', 'insuranceStart', 'insuranceEnd'].includes(field.key)) {
                    displayValue = formatDate(carData[field.key]);
                }
                carDataHTML += `<li style="flex: 1 1 300px; margin-bottom: 5px;"><strong>${field.label}:</strong> ${displayValue}</li>`;
            });
            carDataHTML += '</ul>';
            document.getElementById('print-car-header').textContent = `ุณุฌูุงุช ุงูุณูุงุฑุฉ: ${carData.make || ''} ${carData.model || ''} (${carData.serial})`;
            document.getElementById('print-car-data').innerHTML = carDataHTML;
        }


        // ----------------------------------------------------
        // ุชุดุบูู ุงูุฏูุงู ุงูุฃุณุงุณูุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        // ----------------------------------------------------

        // ุงูุฒููุช
        document.getElementById('current-reading').oninput = calculateNextChange;
        document.getElementById('oil-validity').oninput = calculateNextChange;
        
        // ุงูุตูุงูุฉ
        document.getElementById('parts-cost').oninput = calculateTotal;
        document.getElementById('labor-cost').oninput = calculateTotal;

        // ูุทุน ุงูุบูุงุฑ ๐ก
        // ุฏุงูุฉ ุชูููุฏ ุงูุจุงุฑููุฏ ุชู ุฑุจุทูุง ูู HTML
        document.getElementById('parts-cost-per-unit').oninput = calculatePartsTotal;
        document.getElementById('parts-quantity').oninput = calculatePartsTotal;
        document.getElementById('parts-tax-rate').oninput = calculatePartsTotal;
        
        document.addEventListener('DOMContentLoaded', () => {
            populateCarSelector();
            populateYearSelectors(); 
            // ุฅุฎูุงุก ุงูุฃูุณุงู ุนูุฏ ุงูุชุญููู
            document.getElementById('oil-fieldset').style.display = 'none';
            document.getElementById('maintenance-fieldset').style.display = 'none';
            document.getElementById('parts-fieldset').style.display = 'none'; 
            document.getElementById('reports-fieldset').style.display = 'none';
            
            // ุงูุชุฃูุฏ ูู ุฅุฎูุงุก ุฃุฒุฑุงุฑ ุงูุชุนุฏูู ุนูุฏ ุงูุชุญููู
            document.getElementById('save-oil-edit').style.display = 'none';
            document.getElementById('save-maintenance-edit').style.display = 'none';
            document.getElementById('save-parts-edit').style.display = 'none'; 
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script> 
</body>
</html>